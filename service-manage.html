<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Service Management - FreshMart POS</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
*{font-family:'Inter',sans-serif}
input:focus,select:focus,textarea:focus{outline:none;border-color:#10b981;box-shadow:0 0 0 3px rgba(16,185,129,0.1)}
@keyframes slideIn{from{opacity:0;transform:scale(0.95)}to{opacity:1;transform:scale(1)}}
.animate-modal{animation:slideIn 0.15s ease-out}
@media print{.no-print{display:none!important}body{background:#fff!important;padding:0!important}}
@page{size:A5;margin:8mm}
</style>
</head>
<body class="bg-slate-100 min-h-screen">

<main class="no-print max-w-7xl mx-auto px-6 py-5 space-y-4">
<div class="bg-white rounded-xl shadow-sm border border-slate-200/80 overflow-hidden">
<div class="flex border-b border-slate-200 justify-between items-center">
<div class="flex">
<button onclick="switchTab('pending')" id="tabPending" class="px-6 py-3 text-sm font-semibold text-emerald-600 border-b-2 border-emerald-600 bg-white -mb-px flex items-center gap-2">
Pending <span id="pendingBadge" class="px-1.5 py-0.5 bg-amber-100 text-amber-700 text-[10px] font-bold rounded">4</span>
</button>
<button onclick="switchTab('completed')" id="tabCompleted" class="px-6 py-3 text-sm font-medium text-slate-500 border-b-2 border-transparent hover:text-slate-700">Completed</button>
<button onclick="switchTab('cancelled')" id="tabCancelled" class="px-6 py-3 text-sm font-medium text-slate-500 border-b-2 border-transparent hover:text-slate-700">Cancelled</button>
</div>
<div class="flex items-center gap-2 pr-4">
<a href="#" class="px-3 py-1.5 text-xs text-white bg-emerald-600 hover:bg-emerald-700 rounded-lg font-medium flex items-center gap-1.5">
<svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/></svg>
New Service
</a>
</div>
</div>

<div class="p-3 border-b border-slate-100 bg-slate-50/50">
<div class="flex flex-col md:flex-row gap-2">
<div class="flex-1 relative">
<svg class="w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-slate-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
<input type="text" id="search" placeholder="Search service ID, product, customer..." class="w-full pl-9 pr-4 py-2 border border-slate-200 rounded-lg text-xs" oninput="renderTable()">
</div>
<select id="filterStatus" class="px-3 py-2 border border-slate-200 rounded-lg text-xs text-slate-600" onchange="renderTable()">
<option value="">All Status</option>
<option value="Received">Received</option>
<option value="In Progress">In Progress</option>
<option value="Completed">Completed</option>
<option value="Ready">Ready for Delivery</option>
</select>
<select id="filterStaff" class="px-3 py-2 border border-slate-200 rounded-lg text-xs text-slate-600" onchange="renderTable()">
<option value="">All Staff</option>
<option value="Kamal">Kamal</option>
<option value="Rahim">Rahim</option>
<option value="Jabbar">Jabbar</option>
</select>
</div>
</div>

<table class="w-full" id="serviceTable">
<thead class="bg-slate-50 border-b border-slate-200">
<tr class="text-[10px] text-slate-500 uppercase tracking-wider">
<th class="px-5 py-3 text-left font-semibold">Service ID</th>
<th class="px-5 py-3 text-left font-semibold">Product</th>
<th class="px-5 py-3 text-left font-semibold">Customer</th>
<th class="px-5 py-3 text-left font-semibold">Problem</th>
<th class="px-5 py-3 text-center font-semibold">Status</th>
<th class="px-5 py-3 text-left font-semibold">Staff</th>
<th class="px-5 py-3 text-right font-semibold">Due</th>
<th class="px-5 py-3 text-center font-semibold">Actions</th>
</tr>
</thead>
<tbody id="tableBody" class="divide-y divide-slate-100"></tbody>
</table>

<div id="emptyState" class="p-12 text-center" style="display:none">
<p class="text-slate-400">No services found</p>
</div>

<div class="px-5 py-3 border-t border-slate-200 bg-slate-50/50">
<p class="text-xs text-slate-500">Showing <span id="showCount" class="font-medium text-slate-700">0</span> services</p>
</div>
</div>
</main>

<!-- Status Modal -->
<div id="statusModal" class="fixed inset-0 z-50 flex items-center justify-center p-4" style="display:none">
<div class="absolute inset-0 bg-slate-900/40 backdrop-blur-sm" onclick="closeModal()"></div>
<div class="relative bg-white rounded-xl shadow-2xl w-full max-w-md animate-modal">
<div class="px-5 py-4 border-b border-slate-200 flex items-center justify-between">
<div>
<h2 class="font-semibold text-slate-800">Update Service</h2>
<p class="text-xs text-slate-400 mt-0.5" id="mServiceInfo">SRV-2025-0048 • Samsung Galaxy A54</p>
</div>
<button onclick="closeModal()" class="p-1 text-slate-400 hover:text-slate-600 rounded">
<svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
</button>
</div>

<div class="p-5 space-y-4">
<div class="flex gap-3 p-3 bg-slate-50 rounded-lg">
<div class="flex-1">
<p class="text-[10px] text-slate-400 uppercase">Customer</p>
<p class="text-sm font-medium" id="mCustName">Mohammad Rafiq</p>
<p class="text-xs text-slate-400" id="mCustPhone">01712-345678</p>
</div>
<div class="text-right">
<p class="text-[10px] text-slate-400 uppercase">Due Amount</p>
<p class="text-lg font-bold text-red-600" id="mDue">৳1,000</p>
</div>
</div>

<div>
<label class="text-xs text-slate-500 font-semibold uppercase tracking-wider">Assign to Staff</label>
<select id="mStaff" class="w-full mt-1.5 px-3 py-2 border border-slate-200 rounded-lg text-sm">
<option value="">Select staff...</option>
<option value="Kamal">Kamal - Technician</option>
<option value="Rahim">Rahim - Technician</option>
<option value="Jabbar">Jabbar - Senior Tech</option>
</select>
</div>

<div>
<label class="text-xs text-slate-500 font-semibold uppercase tracking-wider">Service Status</label>
<div class="mt-2 grid grid-cols-2 gap-2">
<button onclick="selectStatus('In Progress')" class="status-btn px-3 py-2 border border-slate-200 rounded-lg text-xs font-medium hover:border-blue-500 hover:bg-blue-50 flex items-center gap-2" data-status="In Progress">
<span class="w-2 h-2 rounded-full bg-blue-500"></span>In Progress
</button>
<button onclick="selectStatus('Completed')" class="status-btn px-3 py-2 border border-slate-200 rounded-lg text-xs font-medium hover:border-emerald-500 hover:bg-emerald-50 flex items-center gap-2" data-status="Completed">
<span class="w-2 h-2 rounded-full bg-emerald-500"></span>Completed
</button>
<button onclick="selectStatus('Ready')" class="status-btn px-3 py-2 border border-slate-200 rounded-lg text-xs font-medium hover:border-purple-500 hover:bg-purple-50 flex items-center gap-2" data-status="Ready">
<span class="w-2 h-2 rounded-full bg-purple-500"></span>Ready for Delivery
</button>
<button onclick="selectStatus('Not Possible')" class="status-btn px-3 py-2 border border-slate-200 rounded-lg text-xs font-medium hover:border-red-500 hover:bg-red-50 flex items-center gap-2" data-status="Not Possible">
<span class="w-2 h-2 rounded-full bg-red-500"></span>Not Possible
</button>
</div>
</div>

<div>
<label class="text-xs text-slate-500 font-semibold uppercase tracking-wider">Service Notes</label>
<textarea id="mNotes" rows="2" class="w-full mt-1.5 px-3 py-2 border border-slate-200 rounded-lg text-sm resize-none" placeholder="Add notes about the service..."></textarea>
</div>

<div class="flex items-center gap-2 p-3 bg-blue-50 border border-blue-100 rounded-lg">
<input type="checkbox" id="mSendSMS" class="rounded border-slate-300 text-blue-500 w-4 h-4" checked>
<label for="mSendSMS" class="text-sm text-blue-700">Send SMS notification to customer</label>
</div>
</div>

<div class="px-5 py-4 border-t border-slate-200 flex justify-between bg-slate-50">
<button onclick="printDelivery()" id="btnDelivery" class="px-4 py-2 text-xs text-slate-600 bg-white border border-slate-200 hover:bg-slate-50 rounded-lg font-medium flex items-center gap-1.5" style="display:none">
<svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"/></svg>
Delivery Invoice
</button>
<div class="flex gap-2 ml-auto">
<button onclick="closeModal()" class="px-4 py-2 text-xs text-slate-600 bg-white border border-slate-200 hover:bg-slate-50 rounded-lg font-medium">Cancel</button>
<button onclick="saveStatus()" class="px-4 py-2 text-xs bg-emerald-600 text-white rounded-lg font-medium hover:bg-emerald-700">Save Changes</button>
</div>
</div>
</div>
</div>

<!-- Toast -->
<div id="toast" class="fixed top-4 right-4 z-50 px-4 py-3 bg-slate-800 text-white text-sm rounded-lg shadow-lg flex items-center gap-2" style="display:none">
<svg class="w-5 h-5 text-emerald-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
<span id="toastMsg">Success</span>
</div>

<script>
let services=[
{id:'SRV-2025-0048',product:'Samsung Galaxy A54',serial:'R58T30ABCDE',customer:'Mohammad Rafiq',phone:'01712-345678',problem:'Display Issue',charge:1500,advance:500,due:1000,status:'Received',staff:'',date:'Dec 26, 2025'},
{id:'SRV-2025-0047',product:'iPhone 14 Pro',serial:'IP14P2024001',customer:'Rahim Khan',phone:'01712-111222',problem:'Battery Issue',charge:2500,advance:1000,due:1500,status:'In Progress',staff:'Kamal',date:'Dec 25, 2025'},
{id:'SRV-2025-0046',product:'Xiaomi Note 13',serial:'XM2024N13001',customer:'Fatima Begum',phone:'01898-765432',problem:'Charging Issue',charge:800,advance:300,due:500,status:'Completed',staff:'Rahim',date:'Dec 24, 2025'},
{id:'SRV-2025-0045',product:'OnePlus 12',serial:'OP122024001',customer:'Abdul Karim',phone:'01611-223344',problem:'Camera Issue',charge:1200,advance:500,due:700,status:'Ready',staff:'Jabbar',date:'Dec 23, 2025'},
];
let completedServices=[
{id:'SRV-2025-0040',product:'Realme 12 Pro',serial:'RM2024R12001',customer:'Nusrat Jahan',phone:'01812-333444',problem:'Speaker Issue',charge:600,advance:600,due:0,status:'Delivered',staff:'Kamal',date:'Dec 20, 2025'},
];
let cancelledServices=[
{id:'SRV-2025-0038',product:'Samsung A34',serial:'R58T20XXXXX',customer:'Kamal Hossain',phone:'01511-998877',problem:'Water Damage',charge:0,advance:0,due:0,status:'Not Possible',staff:'Jabbar',date:'Dec 18, 2025'},
];

let currentTab='pending',selectedService=null,selectedStatus='';

function showToast(m){const t=document.getElementById('toast');document.getElementById('toastMsg').textContent=m;t.style.display='flex';setTimeout(()=>t.style.display='none',3000);}

function switchTab(t){
currentTab=t;
document.querySelectorAll('[id^="tab"]').forEach(b=>b.className='px-6 py-3 text-sm font-medium text-slate-500 border-b-2 border-transparent hover:text-slate-700');
document.getElementById('tab'+t.charAt(0).toUpperCase()+t.slice(1)).className='px-6 py-3 text-sm font-semibold text-emerald-600 border-b-2 border-emerald-600 bg-white -mb-px flex items-center gap-2';
renderTable();
}

function getStatusClass(s){
const m={'Received':'bg-slate-100 text-slate-700','In Progress':'bg-blue-50 text-blue-700','Completed':'bg-emerald-50 text-emerald-700','Ready':'bg-purple-50 text-purple-700','Delivered':'bg-green-50 text-green-700','Not Possible':'bg-red-50 text-red-700'};
return m[s]||'bg-slate-100 text-slate-700';
}

function renderTable(){
const search=document.getElementById('search').value.toLowerCase();
const statusF=document.getElementById('filterStatus').value;
const staffF=document.getElementById('filterStaff').value;
let list=currentTab==='pending'?services:currentTab==='completed'?completedServices:cancelledServices;

list=list.filter(s=>(s.id.toLowerCase().includes(search)||s.product.toLowerCase().includes(search)||s.customer.toLowerCase().includes(search))&&(!statusF||s.status===statusF)&&(!staffF||s.staff===staffF));

document.getElementById('showCount').textContent=list.length;
document.getElementById('pendingBadge').textContent=services.length;

if(!list.length){document.getElementById('tableBody').innerHTML='';document.getElementById('emptyState').style.display='block';return;}
document.getElementById('emptyState').style.display='none';

document.getElementById('tableBody').innerHTML=list.map((s,i)=>`
<tr class="${i%2===0?'bg-white':'bg-slate-50/50'} hover:bg-slate-100 text-[13px]">
<td class="px-5 py-3 font-semibold text-slate-800">${s.id}</td>
<td class="px-5 py-3"><p class="text-slate-700">${s.product}</p><p class="text-[10px] text-slate-400 font-mono">${s.serial}</p></td>
<td class="px-5 py-3"><p class="text-slate-700">${s.customer}</p><p class="text-[10px] text-slate-400">${s.phone}</p></td>
<td class="px-5 py-3 text-slate-600">${s.problem}</td>
<td class="px-5 py-3 text-center"><span class="px-2 py-0.5 text-[10px] font-semibold rounded-full ${getStatusClass(s.status)}">${s.status}</span></td>
<td class="px-5 py-3 text-slate-600">${s.staff||'-'}</td>
<td class="px-5 py-3 text-right font-medium ${s.due>0?'text-red-600':'text-emerald-600'}">৳${s.due.toLocaleString()}</td>
<td class="px-5 py-3 text-center">
<div class="flex items-center justify-center gap-1">
<button onclick="openModal('${s.id}')" class="p-1.5 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg" title="Edit"><svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg></button>
<button onclick="printInvoice('${s.id}')" class="p-1.5 text-slate-400 hover:text-emerald-600 hover:bg-emerald-50 rounded-lg" title="Print Invoice"><svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"/></svg></button>
</div>
</td>
</tr>`).join('');
}

function printInvoice(id){
const s=[...services,...completedServices,...cancelledServices].find(x=>x.id===id);
if(!s)return;
const params=new URLSearchParams({
id:s.id,
date:s.date,
custName:s.customer,
custPhone:s.phone,
prodName:s.product,
prodSerial:s.serial,
problem:s.problem+' - Service completed',
charge:s.charge,
advance:s.advance,
due:s.due,
notes:'Service completed successfully. 30-day service warranty.'
});
window.open('service_delivery_invoice.html?'+params.toString(),'_blank');
}

function openModal(id){
selectedService=[...services,...completedServices,...cancelledServices].find(s=>s.id===id);
if(!selectedService)return;
document.getElementById('mServiceInfo').textContent=selectedService.id+' • '+selectedService.product;
document.getElementById('mCustName').textContent=selectedService.customer;
document.getElementById('mCustPhone').textContent=selectedService.phone;
document.getElementById('mDue').textContent='৳'+selectedService.due.toLocaleString();
document.getElementById('mStaff').value=selectedService.staff;
document.getElementById('mNotes').value='';
selectedStatus=selectedService.status;
document.querySelectorAll('.status-btn').forEach(b=>{b.classList.remove('border-emerald-500','bg-emerald-50');if(b.dataset.status===selectedStatus)b.classList.add('border-emerald-500','bg-emerald-50');});
document.getElementById('btnDelivery').style.display=(selectedService.status==='Ready'||selectedService.status==='Completed')?'flex':'none';
document.getElementById('statusModal').style.display='flex';
}

function closeModal(){document.getElementById('statusModal').style.display='none';selectedService=null;}

function selectStatus(s){
selectedStatus=s;
document.querySelectorAll('.status-btn').forEach(b=>{b.classList.remove('border-emerald-500','bg-emerald-50');if(b.dataset.status===s)b.classList.add('border-emerald-500','bg-emerald-50');});
document.getElementById('btnDelivery').style.display=(s==='Ready'||s==='Completed')?'flex':'none';
}

function saveStatus(){
if(!selectedService)return;
selectedService.status=selectedStatus;
selectedService.staff=document.getElementById('mStaff').value;
const sms=document.getElementById('mSendSMS').checked;
closeModal();
showToast('Status updated!'+(sms?' SMS sent to customer.':''));
renderTable();
}

function printDelivery(){
if(!selectedService)return;
const notes=document.getElementById('mNotes').value||'Service completed successfully. 30-day service warranty.';
const params=new URLSearchParams({
id:selectedService.id,
date:selectedService.date,
custName:selectedService.customer,
custPhone:selectedService.phone,
prodName:selectedService.product,
prodSerial:selectedService.serial,
problem:selectedService.problem+' - Service completed',
charge:selectedService.charge,
advance:selectedService.advance,
due:selectedService.due,
notes:notes
});
window.open('service_delivery_invoice.html?'+params.toString(),'_blank');
}

renderTable();
</script>
</body>
</html>
