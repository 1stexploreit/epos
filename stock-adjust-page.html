<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stock Adjustment - FreshMart POS</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
*{font-family:'Inter',sans-serif}
input:focus,select:focus,textarea:focus{outline:none;border-color:#10b981;box-shadow:0 0 0 3px rgba(16,185,129,0.1)}
.item-row{animation:slideIn 0.15s ease}
@keyframes slideIn{from{opacity:0;transform:translateY(-5px)}to{opacity:1;transform:translateY(0)}}
</style>
</head>
<body class="bg-slate-100 min-h-screen">

<!-- Header -->
<div class="bg-white border-b border-slate-200">
<div class="max-w-5xl mx-auto px-6 py-3 flex items-center justify-between">
<div>
<h1 class="text-slate-800 font-semibold">Stock Adjustment</h1>
<p class="text-xs text-slate-400">Adjust stock for warehouse or branch</p>
</div>
<div class="flex items-center gap-3">
<a href="#" onclick="openAdjustmentLog()" class="px-4 py-2 text-sm text-slate-600 bg-slate-100 hover:bg-slate-200 rounded-lg font-medium flex items-center gap-2">
<svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/></svg>
Adjustment Log
</a>
</div>
</div>
</div>

<main class="max-w-5xl mx-auto px-6 py-5 space-y-4">

<!-- Location Selection -->
<div class="bg-white rounded-xl shadow-sm border border-slate-200/80 p-5">
<div class="grid grid-cols-1 md:grid-cols-3 gap-4">
<div>
<label class="text-xs text-slate-500 font-semibold uppercase tracking-wider">Location Type <span class="text-red-400">*</span></label>
<div class="flex gap-2 mt-1.5">
<button onclick="setLocationType('warehouse')" id="typeWarehouse" class="flex-1 py-2.5 rounded-lg border-2 border-emerald-500 bg-emerald-50 text-sm font-medium text-emerald-700">Warehouse</button>
<button onclick="setLocationType('branch')" id="typeBranch" class="flex-1 py-2.5 rounded-lg border-2 border-slate-200 bg-white text-sm font-medium text-slate-500 hover:border-slate-300">Branch</button>
</div>
</div>
<div>
<label class="text-xs text-slate-500 font-semibold uppercase tracking-wider">Select Location <span class="text-red-400">*</span></label>
<select id="location" class="w-full mt-1.5 px-4 py-2.5 border border-slate-200 rounded-lg text-sm" onchange="updateStock()">
<option value="">Select warehouse</option>
<option value="warehouse-main">Main Warehouse</option>
<option value="warehouse-north">North Warehouse</option>
<option value="warehouse-south">South Warehouse</option>
</select>
</div>
<div>
<label class="text-xs text-slate-500 font-semibold uppercase tracking-wider">Adjustment Date</label>
<input type="date" id="adjustDate" class="w-full mt-1.5 px-4 py-2.5 border border-slate-200 rounded-lg text-sm">
</div>
</div>
</div>

<!-- Search & Scan -->
<div class="bg-white rounded-xl shadow-sm border border-slate-200/80 p-5">
<div class="flex flex-col md:flex-row gap-3">
<div class="flex-1 relative">
<svg class="w-5 h-5 absolute left-3 top-1/2 -translate-y-1/2 text-slate-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
<input type="text" id="searchInput" class="w-full pl-10 pr-4 py-2.5 border border-slate-200 rounded-lg text-sm" placeholder="Search by product name..." oninput="searchProducts()">
</div>
<div class="flex gap-2">
<div class="relative flex-1 md:w-48">
<svg class="w-5 h-5 absolute left-3 top-1/2 -translate-y-1/2 text-slate-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h2M4 12h2m10 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"/></svg>
<input type="text" id="barcodeInput" class="w-full pl-10 pr-4 py-2.5 border border-slate-200 rounded-lg text-sm" placeholder="Scan barcode..." onkeypress="handleBarcode(event)">
</div>
<button onclick="openScanner()" class="px-4 py-2.5 bg-slate-100 hover:bg-slate-200 rounded-lg text-sm font-medium text-slate-600 flex items-center gap-2">
<svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M3 9V5a2 2 0 012-2h4M3 15v4a2 2 0 002 2h4m8-18h4a2 2 0 012 2v4m0 6v4a2 2 0 01-2 2h-4"/></svg>
Scan
</button>
</div>
</div>

<!-- Search Results -->
<div id="searchResults" class="mt-2 border border-slate-200 rounded-lg max-h-48 overflow-y-auto" style="display:none">
<div id="searchResultsList"></div>
</div>
</div>

<!-- Adjustment Items -->
<div class="bg-white rounded-xl shadow-sm border border-slate-200/80 overflow-hidden">
<div class="px-5 py-3 bg-slate-50 border-b border-slate-200 flex items-center justify-between">
<h3 class="text-sm font-semibold text-slate-800">Adjustment Items</h3>
<span class="text-xs text-slate-500"><span id="itemCount" class="font-bold text-emerald-600">0</span> items added</span>
</div>

<!-- Table Header -->
<div class="grid grid-cols-12 gap-2 px-5 py-2 bg-slate-50 border-b border-slate-200 text-[10px] text-slate-500 uppercase tracking-wider font-semibold">
<div class="col-span-1">Icon</div>
<div class="col-span-2">SKU</div>
<div class="col-span-2">Product Name</div>
<div class="col-span-1 text-center">Current</div>
<div class="col-span-2 text-center">Type</div>
<div class="col-span-1 text-center">Qty</div>
<div class="col-span-2">Reason</div>
<div class="col-span-1 text-right">Action</div>
</div>

<!-- Items List -->
<div id="adjustItems" class="divide-y divide-slate-100 max-h-72 overflow-y-auto">
<div id="emptyState" class="p-8 text-center">
<div class="w-14 h-14 mx-auto bg-slate-100 rounded-full flex items-center justify-center mb-3">
<svg class="w-7 h-7 text-slate-300" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/></svg>
</div>
<p class="text-sm text-slate-500">No products added</p>
<p class="text-xs text-slate-400 mt-1">Search or scan barcode to add products</p>
</div>
</div>
</div>

<!-- Notes -->
<div class="bg-white rounded-xl shadow-sm border border-slate-200/80 p-5">
<label class="text-xs text-slate-500 font-semibold uppercase tracking-wider">Note</label>
<textarea id="note" rows="2" class="w-full mt-1.5 px-4 py-2.5 border border-slate-200 rounded-lg text-sm resize-none" placeholder="Optional note for this adjustment..."></textarea>
</div>

<!-- Action Buttons -->
<div class="flex items-center justify-between bg-white rounded-xl shadow-sm border border-slate-200/80 p-4">
<button onclick="resetForm()" class="px-5 py-2.5 text-sm text-slate-600 bg-slate-100 hover:bg-slate-200 rounded-lg font-medium">Reset</button>
<button onclick="submitAdjustment()" class="px-6 py-2.5 bg-gradient-to-r from-emerald-500 to-emerald-600 text-white rounded-lg font-medium text-sm flex items-center gap-2 shadow-lg shadow-emerald-500/20">
<svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
Submit Adjustment
</button>
</div>

</main>

<!-- Toast -->
<div id="toast" class="fixed top-4 right-4 z-50 px-4 py-3 bg-slate-800 text-white text-sm rounded-lg shadow-lg flex items-center gap-2" style="display:none">
<svg class="w-5 h-5 text-emerald-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
<span id="toastMsg">Success</span>
</div>

<!-- Confirm Modal -->
<div id="confirmModal" class="fixed inset-0 z-50 flex items-center justify-center p-4" style="display:none">
<div class="absolute inset-0 bg-slate-900/40 backdrop-blur-sm" onclick="closeConfirmModal()"></div>
<div class="relative bg-white rounded-xl shadow-2xl w-full max-w-md p-6">
<h3 class="text-lg font-semibold text-slate-800 mb-4">Confirm Stock Adjustment</h3>
<div class="bg-slate-50 rounded-lg p-4 mb-4 space-y-2 text-sm">
<div class="flex justify-between"><span class="text-slate-500">Location:</span><span class="font-medium text-slate-700" id="confirmLocation">â€”</span></div>
<div class="flex justify-between"><span class="text-slate-500">Total Items:</span><span class="font-bold text-emerald-600" id="confirmItems">0</span></div>
<div class="flex justify-between"><span class="text-slate-500">Increase Qty:</span><span class="font-bold text-emerald-600" id="confirmIncrease">0</span></div>
<div class="flex justify-between"><span class="text-slate-500">Decrease Qty:</span><span class="font-bold text-red-500" id="confirmDecrease">0</span></div>
</div>
<div class="flex gap-3">
<button onclick="closeConfirmModal()" class="flex-1 px-4 py-2.5 text-sm text-slate-600 bg-slate-100 hover:bg-slate-200 rounded-lg font-medium">Cancel</button>
<button onclick="confirmAdjustment()" class="flex-1 px-4 py-2.5 text-sm bg-emerald-500 hover:bg-emerald-600 text-white rounded-lg font-medium">Confirm</button>
</div>
</div>
</div>

<script>
const products=[
{id:1,sku:'SKU001',name:'Fresh Apple',emoji:'ðŸŽ',stock:{'warehouse-main':500,'warehouse-north':300,'warehouse-south':200,'main':150,'dhanmondi':80,'uttara':45,'mirpur':60}},
{id:2,sku:'SKU002',name:'Banana Bunch',emoji:'ðŸŒ',stock:{'warehouse-main':600,'warehouse-north':400,'warehouse-south':350,'main':200,'dhanmondi':120,'uttara':90,'mirpur':75}},
{id:3,sku:'SKU003',name:'Orange Fresh',emoji:'ðŸŠ',stock:{'warehouse-main':450,'warehouse-north':280,'warehouse-south':190,'main':100,'dhanmondi':65,'uttara':40,'mirpur':55}},
{id:4,sku:'SKU004',name:'Milk 1L Pack',emoji:'ðŸ¥›',stock:{'warehouse-main':800,'warehouse-north':500,'warehouse-south':400,'main':300,'dhanmondi':150,'uttara':100,'mirpur':120}},
{id:5,sku:'SKU005',name:'Whole Wheat Bread',emoji:'ðŸž',stock:{'warehouse-main':300,'warehouse-north':180,'warehouse-south':120,'main':80,'dhanmondi':45,'uttara':30,'mirpur':40}},
{id:6,sku:'SKU006',name:'Eggs (12 pcs)',emoji:'ðŸ¥š',stock:{'warehouse-main':700,'warehouse-north':450,'warehouse-south':380,'main':250,'dhanmondi':130,'uttara':85,'mirpur':95}},
{id:7,sku:'SKU007',name:'Chicken Breast',emoji:'ðŸ—',stock:{'warehouse-main':400,'warehouse-north':250,'warehouse-south':180,'main':120,'dhanmondi':70,'uttara':50,'mirpur':60}},
{id:8,sku:'SKU008',name:'Rice 5kg Bag',emoji:'ðŸš',stock:{'warehouse-main':550,'warehouse-north':320,'warehouse-south':280,'main':180,'dhanmondi':90,'uttara':65,'mirpur':80}},
{id:9,sku:'SKU009',name:'Coca Cola 500ml',emoji:'ðŸ¥¤',stock:{'warehouse-main':1000,'warehouse-north':650,'warehouse-south':500,'main':400,'dhanmondi':200,'uttara':150,'mirpur':180}},
{id:10,sku:'SKU010',name:'Potato Chips',emoji:'ðŸ¿',stock:{'warehouse-main':650,'warehouse-north':400,'warehouse-south':320,'main':220,'dhanmondi':110,'uttara':80,'mirpur':95}},
];

const reasons=[
{value:'damaged',label:'Damaged'},
{value:'expired',label:'Expired'},
{value:'lost',label:'Lost/Theft'},
{value:'found',label:'Found'},
{value:'recount',label:'Stock Recount'},
{value:'return',label:'Supplier Return'},
{value:'sample',label:'Sample/Promo'},
{value:'other',label:'Other'}
];

let locationType='warehouse';
let adjustItems=[];

function showToast(msg){
const t=document.getElementById('toast');
document.getElementById('toastMsg').textContent=msg;
t.style.display='flex';
setTimeout(()=>t.style.display='none',3000);
}

function setLocationType(type){
locationType=type;
const warehouseBtn=document.getElementById('typeWarehouse');
const branchBtn=document.getElementById('typeBranch');
const locationSelect=document.getElementById('location');

if(type==='warehouse'){
warehouseBtn.className='flex-1 py-2.5 rounded-lg border-2 border-emerald-500 bg-emerald-50 text-sm font-medium text-emerald-700';
branchBtn.className='flex-1 py-2.5 rounded-lg border-2 border-slate-200 bg-white text-sm font-medium text-slate-500 hover:border-slate-300';
locationSelect.innerHTML=`<option value="">Select warehouse</option>
<option value="warehouse-main">Main Warehouse</option>
<option value="warehouse-north">North Warehouse</option>
<option value="warehouse-south">South Warehouse</option>`;
}else{
branchBtn.className='flex-1 py-2.5 rounded-lg border-2 border-emerald-500 bg-emerald-50 text-sm font-medium text-emerald-700';
warehouseBtn.className='flex-1 py-2.5 rounded-lg border-2 border-slate-200 bg-white text-sm font-medium text-slate-500 hover:border-slate-300';
locationSelect.innerHTML=`<option value="">Select branch</option>
<option value="main">Main Branch</option>
<option value="dhanmondi">Dhanmondi Branch</option>
<option value="uttara">Uttara Branch</option>
<option value="mirpur">Mirpur Branch</option>`;
}
adjustItems=[];
renderAdjustItems();
}

function searchProducts(){
const query=document.getElementById('searchInput').value.toLowerCase().trim();
const resultsDiv=document.getElementById('searchResults');
const listDiv=document.getElementById('searchResultsList');
const location=document.getElementById('location').value;

if(!query){resultsDiv.style.display='none';return;}
if(!location){showToast('Select location first');return;}

const filtered=products.filter(p=>p.name.toLowerCase().includes(query)||p.sku.toLowerCase().includes(query));

if(filtered.length){
listDiv.innerHTML=filtered.map(p=>{
const stock=p.stock[location]||0;
const added=adjustItems.find(i=>i.id===p.id);
return`<div class="flex items-center justify-between p-3 hover:bg-slate-50 cursor-pointer border-b border-slate-100 last:border-0" onclick="addProduct(${p.id})">
<div class="flex items-center gap-3">
<span class="text-xl">${p.emoji}</span>
<div>
<p class="text-sm font-medium text-slate-700">${p.name}</p>
<p class="text-xs text-slate-400">${p.sku}</p>
</div>
</div>
<div class="text-right">
<p class="text-sm font-bold text-slate-700">${stock} pcs</p>
${added?'<span class="text-[10px] text-amber-500 font-medium">Added</span>':''}
</div>
</div>`;
}).join('');
resultsDiv.style.display='block';
}else{
listDiv.innerHTML='<p class="p-4 text-sm text-slate-400 text-center">No products found</p>';
resultsDiv.style.display='block';
}
}

function handleBarcode(e){
if(e.key==='Enter'){
const barcode=document.getElementById('barcodeInput').value.trim().toUpperCase();
const product=products.find(p=>p.sku.toUpperCase()===barcode);
if(product){
addProduct(product.id);
document.getElementById('barcodeInput').value='';
}else{
showToast('Product not found');
}
}
}

function addProduct(id){
const location=document.getElementById('location').value;
if(!location){showToast('Select location first');return;}

const product=products.find(p=>p.id===id);
if(!product)return;

const existing=adjustItems.find(i=>i.id===id);
if(existing){
showToast('Product already added');
return;
}

const stock=product.stock[location]||0;

adjustItems.push({
id:product.id,
sku:product.sku,
name:product.name,
emoji:product.emoji,
currentStock:stock,
type:'increase',
qty:1,
reason:'recount'
});

document.getElementById('searchInput').value='';
document.getElementById('searchResults').style.display='none';
renderAdjustItems();
showToast('Product added');
}

function renderAdjustItems(){
const container=document.getElementById('adjustItems');

if(!adjustItems.length){
container.innerHTML=`<div id="emptyState" class="p-8 text-center">
<div class="w-14 h-14 mx-auto bg-slate-100 rounded-full flex items-center justify-center mb-3">
<svg class="w-7 h-7 text-slate-300" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/></svg>
</div>
<p class="text-sm text-slate-500">No products added</p>
<p class="text-xs text-slate-400 mt-1">Search or scan barcode to add products</p>
</div>`;
document.getElementById('itemCount').textContent='0';
return;
}

const reasonOptions=reasons.map(r=>`<option value="${r.value}">${r.label}</option>`).join('');

container.innerHTML=adjustItems.map((item,idx)=>`
<div class="item-row grid grid-cols-12 gap-2 px-5 py-3 items-center">
<div class="col-span-1">
<span class="text-xl">${item.emoji}</span>
</div>
<div class="col-span-2">
<span class="text-xs font-mono text-slate-500">${item.sku}</span>
</div>
<div class="col-span-2">
<span class="text-sm font-medium text-slate-700">${item.name}</span>
</div>
<div class="col-span-1 text-center">
<span class="text-sm font-bold text-slate-600">${item.currentStock}</span>
</div>
<div class="col-span-2 flex justify-center gap-1">
<button onclick="setType(${idx},'increase')" class="px-2 py-1 text-xs font-medium rounded ${item.type==='increase'?'bg-emerald-500 text-white':'bg-slate-100 text-slate-500 hover:bg-slate-200'}">+ Add</button>
<button onclick="setType(${idx},'decrease')" class="px-2 py-1 text-xs font-medium rounded ${item.type==='decrease'?'bg-red-500 text-white':'bg-slate-100 text-slate-500 hover:bg-slate-200'}">âˆ’ Remove</button>
</div>
<div class="col-span-1">
<input type="number" value="${item.qty}" min="1" onchange="setQty(${idx},this.value)" class="w-full text-center py-1 border border-slate-200 rounded text-sm font-medium">
</div>
<div class="col-span-2">
<select onchange="setReason(${idx},this.value)" class="w-full px-2 py-1 border border-slate-200 rounded text-xs">
${reasons.map(r=>`<option value="${r.value}" ${item.reason===r.value?'selected':''}>${r.label}</option>`).join('')}
</select>
</div>
<div class="col-span-1 text-right">
<button onclick="removeItem(${idx})" class="p-2 text-red-400 hover:text-red-500 hover:bg-red-50 rounded-lg">
<svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
</button>
</div>
</div>
`).join('');

document.getElementById('itemCount').textContent=adjustItems.length;
}

function setType(idx,type){
adjustItems[idx].type=type;
renderAdjustItems();
}

function setQty(idx,val){
adjustItems[idx].qty=Math.max(1,parseInt(val)||1);
renderAdjustItems();
}

function setReason(idx,reason){
adjustItems[idx].reason=reason;
}

function removeItem(idx){
adjustItems.splice(idx,1);
renderAdjustItems();
showToast('Item removed');
}

function updateStock(){
const location=document.getElementById('location').value;
adjustItems.forEach(item=>{
const product=products.find(p=>p.id===item.id);
if(product){
item.currentStock=product.stock[location]||0;
}
});
renderAdjustItems();
}

function resetForm(){
document.getElementById('location').value='';
document.getElementById('note').value='';
adjustItems=[];
renderAdjustItems();
showToast('Form reset');
}

function submitAdjustment(){
const location=document.getElementById('location').value;
if(!location){alert('Select location');return;}
if(!adjustItems.length){alert('Add at least one product');return;}

const locationText=document.getElementById('location').options[document.getElementById('location').selectedIndex].text;
const totalIncrease=adjustItems.filter(i=>i.type==='increase').reduce((sum,i)=>sum+i.qty,0);
const totalDecrease=adjustItems.filter(i=>i.type==='decrease').reduce((sum,i)=>sum+i.qty,0);

document.getElementById('confirmLocation').textContent=locationText;
document.getElementById('confirmItems').textContent=adjustItems.length;
document.getElementById('confirmIncrease').textContent='+'+totalIncrease+' pcs';
document.getElementById('confirmDecrease').textContent='-'+totalDecrease+' pcs';

document.getElementById('confirmModal').style.display='flex';
}

function closeConfirmModal(){
document.getElementById('confirmModal').style.display='none';
}

function confirmAdjustment(){
closeConfirmModal();
showToast('Stock adjustment submitted successfully!');
resetForm();
}

function openAdjustmentLog(){showToast('Opening adjustment log...');}
function openScanner(){showToast('Scanner opening...');}

// Init
document.getElementById('adjustDate').valueAsDate=new Date();
</script>
</body>
</html>
