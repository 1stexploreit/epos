<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Purchase List - FreshMart POS</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
    *{font-family:'Inter',sans-serif;box-sizing:border-box;}
    body{background:#f8fafc;min-height:100vh;}
    .card{background:#fff;border:1px solid #e2e8f0;border-radius:10px;box-shadow:0 1px 3px rgba(0,0,0,0.05);}
    .input-light{background:#f8fafc;border:1px solid #e2e8f0;color:#1e293b;border-radius:6px;}
    .input-light:focus{outline:none;border-color:#10b981;box-shadow:0 0 0 3px rgba(16,185,129,0.1);}
    .btn-primary{background:linear-gradient(135deg,#10b981 0%,#059669 100%);color:#fff;font-weight:600;}
    .btn-primary:hover{background:linear-gradient(135deg,#34d399 0%,#10b981 100%);}
    .tag{font-size:9px;padding:3px 6px;border-radius:4px;font-weight:600;text-transform:uppercase;}
    ::-webkit-scrollbar{width:6px;height:6px;}
    ::-webkit-scrollbar-track{background:#f1f5f9;}
    ::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:3px;}
    .row-hover:hover{background:#eff6ff;}
    .row-even{background:#f8fafc;}
    .row-odd{background:#ffffff;}
    .status-draft{background:#f1f5f9;color:#64748b;}
    .status-pending{background:#fef3c7;color:#d97706;}
    .status-ordered{background:#dbeafe;color:#2563eb;}
    .status-received{background:#d1fae5;color:#059669;}
    .status-cancelled{background:#fee2e2;color:#dc2626;}
  </style>
</head>
<body class="text-slate-700">
  
  <!-- Header -->
  <header class="bg-white border-b border-slate-200 sticky top-0 z-50">
    <div class="max-w-[1400px] mx-auto px-4 py-3">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-4">
          <button onclick="window.history.back()" class="w-9 h-9 rounded-lg bg-slate-100 hover:bg-slate-200 flex items-center justify-center transition">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
          </button>
          <div>
            <div class="flex items-center gap-2">
              <span class="tag bg-blue-100 text-blue-700">Purchase</span>
              <span class="text-xl font-bold text-slate-800">Purchase List</span>
            </div>
            <p class="text-xs text-slate-400 mt-0.5">View and manage all purchase orders</p>
          </div>
        </div>
        <div class="flex items-center gap-2">
          <button onclick="exportPurchases()" class="px-3 py-2 rounded-lg bg-slate-100 hover:bg-slate-200 text-sm font-medium transition flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/></svg>
            Export
          </button>
          <a href="#" class="btn-primary px-4 py-2 rounded-lg text-sm flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
            New Purchase
          </a>
        </div>
      </div>
    </div>
  </header>

  <main class="max-w-[1400px] mx-auto p-4 md:p-6">
    
    <!-- Summary Cards -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
      <div class="card p-4">
        <div class="flex items-center gap-3">
          <div class="w-9 h-9 rounded-lg bg-blue-100 flex items-center justify-center">
            <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/></svg>
          </div>
          <div>
            <p class="text-xs text-slate-400">Total Purchase</p>
            <p class="text-xl font-bold text-slate-800">$32,450</p>
          </div>
        </div>
      </div>
      <div class="card p-4">
        <div class="flex items-center gap-3">
          <div class="w-9 h-9 rounded-lg bg-emerald-100 flex items-center justify-center">
            <svg class="w-5 h-5 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
          </div>
          <div>
            <p class="text-xs text-slate-400">Paid</p>
            <p class="text-xl font-bold text-emerald-600">$28,200</p>
          </div>
        </div>
      </div>
      <div class="card p-4">
        <div class="flex items-center gap-3">
          <div class="w-9 h-9 rounded-lg bg-amber-100 flex items-center justify-center">
            <svg class="w-5 h-5 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
          </div>
          <div>
            <p class="text-xs text-slate-400">Due</p>
            <p class="text-xl font-bold text-amber-600">$4,250</p>
          </div>
        </div>
      </div>
      <div class="card p-4">
        <div class="flex items-center gap-3">
          <div class="w-9 h-9 rounded-lg bg-purple-100 flex items-center justify-center">
            <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
          </div>
          <div>
            <p class="text-xs text-slate-400">Suppliers</p>
            <p class="text-xl font-bold text-purple-600">24</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Filters -->
    <div class="card p-4 mb-4 bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-100">
      <div class="flex flex-wrap gap-3 items-center">
        <div class="flex items-center gap-2 bg-white border border-blue-200 rounded-lg px-2 py-1.5 shadow-sm">
          <svg class="w-4 h-4 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
          <input type="text" id="searchInput" placeholder="Search PO, supplier..." class="bg-transparent border-0 text-sm w-44 focus:outline-none" oninput="filterPurchases()">
        </div>
        <div class="flex items-center gap-2 bg-white border border-blue-200 rounded-lg px-2 py-1.5 shadow-sm">
          <svg class="w-4 h-4 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
          <input type="date" id="dateFrom" class="bg-transparent border-0 text-sm focus:outline-none" onchange="filterPurchases()">
          <span class="text-slate-400">-</span>
          <input type="date" id="dateTo" class="bg-transparent border-0 text-sm focus:outline-none" onchange="filterPurchases()">
        </div>
        <select id="statusFilter" onchange="filterPurchases()" class="bg-white border border-blue-200 rounded-lg px-2 py-1.5 text-sm shadow-sm focus:outline-none">
          <option value="">All Status</option>
          <option value="draft">üìù Draft</option>
          <option value="pending">üìã Pending</option>
          <option value="ordered">üì¶ Ordered</option>
          <option value="received">‚úÖ Received</option>
          <option value="cancelled">‚ùå Cancelled</option>
        </select>
        <select id="paymentFilter" onchange="filterPurchases()" class="bg-white border border-blue-200 rounded-lg px-2 py-1.5 text-sm shadow-sm focus:outline-none">
          <option value="">All Payments</option>
          <option value="paid">Fully Paid</option>
          <option value="partial">Partial</option>
          <option value="unpaid">Unpaid</option>
        </select>
        <select id="supplierFilter" onchange="filterPurchases()" class="bg-white border border-blue-200 rounded-lg px-2 py-1.5 text-sm shadow-sm focus:outline-none">
          <option value="">All Suppliers</option>
          <option value="1">Fresh Farms Co.</option>
          <option value="2">Dairy Direct</option>
          <option value="3">Meat Masters</option>
        </select>
        <select id="warehouse" class="bg-white border border-blue-200 rounded-lg px-2 py-1.5 text-sm shadow-sm focus:outline-none">
          <option value="all">All Warehouses</option>
          <option value="main">Main Warehouse</option>
          <option value="branch1">Branch 1</option>
        </select>
        <button onclick="resetFilters()" class="px-3 py-1.5 text-sm text-blue-600 hover:text-blue-700 font-medium">Reset</button>
      </div>
    </div>

    <!-- Purchase Table -->
    <div class="card overflow-hidden">
      <div class="px-4 py-3 border-b border-slate-100 flex items-center justify-end">
        <div class="flex items-center gap-2 text-sm text-slate-500">
          <span>Show</span>
          <select id="pageSize" onchange="renderPurchases()" class="bg-slate-100 border-0 rounded-lg px-2 py-1 text-sm">
            <option value="10">10</option>
            <option value="25">25</option>
            <option value="50">50</option>
          </select>
          <span>entries</span>
        </div>
      </div>
      
      <div class="overflow-x-auto">
        <table class="w-full" style="font-size: 0.80em;">
          <thead>
            <tr class="bg-slate-50">
              <th class="text-left p-3 text-xs font-semibold text-slate-500 uppercase tracking-wider">PO Number</th>
              <th class="text-left p-3 text-xs font-semibold text-slate-500 uppercase tracking-wider">Date</th>
              <th class="text-left p-3 text-xs font-semibold text-slate-500 uppercase tracking-wider">Supplier</th>
              <th class="text-left p-3 text-xs font-semibold text-slate-500 uppercase tracking-wider">Supplier Inv.</th>
              <th class="text-center p-3 text-xs font-semibold text-slate-500 uppercase tracking-wider">Items</th>
              <th class="text-right p-3 text-xs font-semibold text-slate-500 uppercase tracking-wider">Total</th>
              <th class="text-right p-3 text-xs font-semibold text-slate-500 uppercase tracking-wider">Paid</th>
              <th class="text-right p-3 text-xs font-semibold text-slate-500 uppercase tracking-wider">Due</th>
              <th class="text-center p-3 text-xs font-semibold text-slate-500 uppercase tracking-wider">Status</th>
              <th class="text-center p-3 text-xs font-semibold text-slate-500 uppercase tracking-wider w-16">Action</th>
            </tr>
          </thead>
          <tbody id="purchaseBody"></tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div class="px-4 py-3 border-t border-slate-100 flex items-center justify-between">
        <div class="flex items-center gap-2 text-sm text-slate-500">
          <span>Show</span>
          <select id="pageSizeBottom" onchange="document.getElementById('pageSize').value=this.value;renderPurchases()" class="bg-slate-100 border-0 rounded-lg px-2 py-1 text-sm">
            <option value="10">10</option>
            <option value="25">25</option>
            <option value="50">50</option>
          </select>
          <span class="text-slate-400">|</span>
          <span>Showing <span id="showingFrom">1</span>-<span id="showingTo">10</span> of <span id="totalItems">48</span></span>
        </div>
        <div class="flex items-center gap-1">
          <button onclick="prevPage()" class="px-3 py-1.5 rounded-lg bg-slate-100 hover:bg-slate-200 text-sm disabled:opacity-50">Previous</button>
          <div id="pageNumbers" class="flex items-center gap-1"></div>
          <button onclick="nextPage()" class="px-3 py-1.5 rounded-lg bg-slate-100 hover:bg-slate-200 text-sm disabled:opacity-50">Next</button>
        </div>
      </div>
    </div>
  </main>

  <!-- View Modal -->
  <div id="viewModal" class="fixed inset-0 bg-black/40 backdrop-blur-sm items-center justify-center z-50 p-4 hidden">
    <div class="card p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto">
      <div class="flex items-center justify-between mb-4">
        <div>
          <h3 class="text-lg font-bold text-slate-800">Purchase Order Details</h3>
          <p id="modalPO" class="text-blue-600 font-semibold">PUR-0001</p>
        </div>
        <button onclick="closeViewModal()" class="w-8 h-8 rounded-lg bg-slate-100 hover:bg-slate-200 flex items-center justify-center">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <div id="modalContent"></div>
      <div class="flex gap-3 mt-5 pt-4 border-t border-slate-100">
        <button onclick="closeViewModal()" class="flex-1 py-2.5 rounded-xl bg-slate-100 hover:bg-slate-200 font-medium transition">Close</button>
        <button onclick="printPO()" class="flex-1 py-2.5 btn-primary rounded-xl flex items-center justify-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"/></svg>
          Print
        </button>
      </div>
    </div>
  </div>

  <!-- Delete Modal -->
  <div id="deleteModal" class="fixed inset-0 bg-black/40 backdrop-blur-sm items-center justify-center z-50 p-4 hidden">
    <div class="card p-6 w-full max-w-sm text-center">
      <div class="w-14 h-14 rounded-full bg-red-100 flex items-center justify-center mx-auto mb-4">
        <svg class="w-7 h-7 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
      </div>
      <h3 class="text-lg font-bold text-slate-800 mb-2">Delete Purchase Order?</h3>
      <p class="text-sm text-slate-500 mb-5">This action cannot be undone. The purchase order will be permanently removed.</p>
      <div class="flex gap-3">
        <button onclick="closeDeleteModal()" class="flex-1 py-2.5 rounded-xl bg-slate-100 hover:bg-slate-200 font-medium transition">Cancel</button>
        <button onclick="confirmDelete()" class="flex-1 py-2.5 rounded-xl bg-red-500 hover:bg-red-600 text-white font-medium transition">Delete</button>
      </div>
    </div>
  </div>

  <!-- Receive Stock Modal -->
  <div id="receiveModal" class="fixed inset-0 bg-black/40 backdrop-blur-sm items-center justify-center z-50 p-4 hidden">
    <div class="card p-6 w-full max-w-md">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-bold text-slate-800">Receive Stock</h3>
        <button onclick="closeReceiveModal()" class="w-8 h-8 rounded-lg bg-slate-100 hover:bg-slate-200 flex items-center justify-center">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <div id="receiveContent" class="space-y-4">
        <div class="bg-blue-50 rounded-xl p-4">
          <p class="text-sm text-blue-600 font-medium" id="receivePO">PUR-0001</p>
          <p class="text-xs text-blue-500" id="receiveSupplier">Fresh Farms Co.</p>
        </div>
        <div>
          <label class="text-xs text-slate-500 uppercase tracking-wider mb-1 block">Received Date</label>
          <input type="date" id="receiveDate" class="w-full input-light px-3 py-2.5 text-sm">
        </div>
        <div>
          <label class="text-xs text-slate-500 uppercase tracking-wider mb-1 block">Notes</label>
          <textarea id="receiveNotes" rows="2" class="w-full input-light px-3 py-2.5 text-sm resize-none" placeholder="Any notes about received items..."></textarea>
        </div>
      </div>
      <div class="flex gap-3 mt-5">
        <button onclick="closeReceiveModal()" class="flex-1 py-2.5 rounded-xl bg-slate-100 hover:bg-slate-200 font-medium transition">Cancel</button>
        <button onclick="confirmReceive()" class="flex-1 py-2.5 btn-primary rounded-xl">Confirm Receive</button>
      </div>
    </div>
  </div>

  <script>
    var purchases = [
      { id: 1, po: 'PUR-0001', date: '2024-01-15', dueDate: '2024-02-14', supplier: 'Fresh Farms Co.', phone: '555-1111', supplierInv: 'FF-2024-001', items: 12, total: 1450.00, paid: 1450.00, status: 'received', method: 'bank' },
      { id: 2, po: 'PUR-0002', date: '2024-01-15', dueDate: '2024-02-14', supplier: 'Dairy Direct', phone: '555-2222', supplierInv: 'DD-0045', items: 8, total: 890.50, paid: 500.00, status: 'ordered', method: 'bank' },
      { id: 3, po: 'PUR-0003', date: '2024-01-14', dueDate: '2024-02-13', supplier: 'Meat Masters', phone: '555-3333', supplierInv: 'MM-789', items: 15, total: 2340.00, paid: 2340.00, status: 'received', method: 'cheque' },
      { id: 4, po: 'PUR-0004', date: '2024-01-14', dueDate: '2024-02-13', supplier: 'Fresh Farms Co.', phone: '555-1111', supplierInv: 'FF-2024-002', items: 6, total: 567.00, paid: 0, status: 'pending', method: '-' },
      { id: 5, po: 'PUR-0005', date: '2024-01-13', dueDate: '2024-02-12', supplier: 'Bakery Supplies Inc.', phone: '555-4444', supplierInv: 'BSI-112', items: 10, total: 780.25, paid: 780.25, status: 'received', method: 'bank' },
      { id: 6, po: 'PUR-0006', date: '2024-01-13', dueDate: '2024-02-12', supplier: 'Veggie Valley', phone: '555-5555', supplierInv: '', items: 4, total: 234.00, paid: 0, status: 'draft', method: '-' },
      { id: 7, po: 'PUR-0007', date: '2024-01-12', dueDate: '2024-02-11', supplier: 'Dairy Direct', phone: '555-2222', supplierInv: 'DD-0046', items: 9, total: 1120.00, paid: 600.00, status: 'ordered', method: 'bank' },
      { id: 8, po: 'PUR-0008', date: '2024-01-12', dueDate: '2024-02-11', supplier: 'Fresh Farms Co.', phone: '555-1111', supplierInv: 'FF-2024-003', items: 7, total: 445.50, paid: 0, status: 'cancelled', method: '-' },
      { id: 9, po: 'PUR-0009', date: '2024-01-11', dueDate: '2024-02-10', supplier: 'Meat Masters', phone: '555-3333', supplierInv: 'MM-790', items: 20, total: 3200.00, paid: 1500.00, status: 'ordered', method: 'cheque' },
      { id: 10, po: 'PUR-0010', date: '2024-01-11', dueDate: '2024-02-10', supplier: 'Packaging Plus', phone: '555-6666', supplierInv: 'PP-2024-01', items: 5, total: 345.00, paid: 345.00, status: 'received', method: 'cash' },
      { id: 11, po: 'PUR-0011', date: '2024-01-10', dueDate: '2024-02-09', supplier: 'Fresh Farms Co.', phone: '555-1111', supplierInv: 'FF-2024-004', items: 11, total: 1890.00, paid: 1890.00, status: 'received', method: 'bank' },
      { id: 12, po: 'PUR-0012', date: '2024-01-10', dueDate: '2024-02-09', supplier: 'Dairy Direct', phone: '555-2222', supplierInv: '', items: 3, total: 456.00, paid: 0, status: 'draft', method: '-' }
    ];

    var currentPage = 1;
    var deleteId = null;
    var receiveId = null;

    var activeActionMenu = null;

    function toggleActions(id) {
      var menu = document.getElementById('actions-' + id);
      if (activeActionMenu && activeActionMenu !== menu) {
        activeActionMenu.classList.add('hidden');
      }
      menu.classList.toggle('hidden');
      activeActionMenu = menu.classList.contains('hidden') ? null : menu;
    }

    function hideActions() {
      if (activeActionMenu) {
        activeActionMenu.classList.add('hidden');
        activeActionMenu = null;
      }
    }

    document.addEventListener('click', function(e) {
      if (!e.target.closest('.relative')) {
        hideActions();
      }
    });

    function getStatusClass(status) {
      var classes = { draft: 'status-draft', pending: 'status-pending', ordered: 'status-ordered', received: 'status-received', cancelled: 'status-cancelled' };
      return classes[status] || 'status-draft';
    }

    function getStatusLabel(status) {
      var labels = { draft: 'üìù Draft', pending: 'üìã Pending', ordered: 'üì¶ Ordered', received: '‚úÖ Received', cancelled: '‚ùå Cancelled' };
      return labels[status] || status;
    }

    function filterPurchases() {
      currentPage = 1;
      renderPurchases();
    }

    function getFilteredPurchases() {
      var search = document.getElementById('searchInput').value.toLowerCase();
      var status = document.getElementById('statusFilter').value;
      var payment = document.getElementById('paymentFilter').value;
      var dateFrom = document.getElementById('dateFrom').value;
      var dateTo = document.getElementById('dateTo').value;

      return purchases.filter(function(p) {
        if (search && p.po.toLowerCase().indexOf(search) === -1 && p.supplier.toLowerCase().indexOf(search) === -1 && p.supplierInv.toLowerCase().indexOf(search) === -1) return false;
        if (status && p.status !== status) return false;
        if (dateFrom && p.date < dateFrom) return false;
        if (dateTo && p.date > dateTo) return false;
        if (payment === 'paid' && p.paid < p.total) return false;
        if (payment === 'partial' && (p.paid === 0 || p.paid >= p.total)) return false;
        if (payment === 'unpaid' && p.paid > 0) return false;
        return true;
      });
    }

    function renderPurchases() {
      var filtered = getFilteredPurchases();
      var pageSize = parseInt(document.getElementById('pageSize').value);
      var start = (currentPage - 1) * pageSize;
      var end = start + pageSize;
      var paged = filtered.slice(start, end);

      var tbody = document.getElementById('purchaseBody');
      var html = '';

      for (var i = 0; i < paged.length; i++) {
        var p = paged[i];
        var due = p.total - p.paid;
        
        html += '<tr class="border-b border-slate-100 row-hover ' + (i % 2 === 0 ? 'row-even' : 'row-odd') + '">';
        html += '<td class="p-3"><span class="font-semibold text-blue-600">' + p.po + '</span></td>';
        html += '<td class="p-3"><span class="text-sm text-slate-600">' + p.date + '</span></td>';
        html += '<td class="p-3"><p class="font-medium text-slate-800">' + p.supplier + '</p></td>';
        html += '<td class="p-3"><span class="text-sm text-slate-600">' + (p.supplierInv || '-') + '</span></td>';
        html += '<td class="p-3 text-center"><span class="tag bg-slate-100 text-slate-600">' + p.items + '</span></td>';
        html += '<td class="p-3 text-right font-semibold text-slate-800">$' + p.total.toFixed(2) + '</td>';
        html += '<td class="p-3 text-right font-medium text-emerald-600">$' + p.paid.toFixed(2) + '</td>';
        html += '<td class="p-3 text-right font-medium ' + (due > 0 ? 'text-red-500' : 'text-slate-400') + '">$' + due.toFixed(2) + '</td>';
        html += '<td class="p-3 text-center"><span class="tag ' + getStatusClass(p.status) + '">' + getStatusLabel(p.status) + '</span></td>';
        html += '<td class="p-3 text-center"><div class="relative inline-block">';
        html += '<button onclick="toggleActions(' + p.id + ')" class="px-2 py-1 rounded-md hover:bg-slate-200 flex items-center justify-center gap-1 text-slate-500 text-xs"><svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="1"/><circle cx="12" cy="5" r="1"/><circle cx="12" cy="19" r="1"/></svg>Action</button>';
        html += '<div id="actions-' + p.id + '" class="hidden absolute right-0 top-full mt-1 bg-white border border-slate-200 rounded-md shadow-lg z-20 py-1 min-w-[120px]">';
        html += '<button onclick="viewPurchase(' + p.id + ');hideActions()" class="w-full px-3 py-1.5 text-left text-sm hover:bg-slate-50 flex items-center gap-2 text-slate-600"><svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>View</button>';
        if (p.status === 'ordered') {
          html += '<button onclick="receivePurchase(' + p.id + ');hideActions()" class="w-full px-3 py-1.5 text-left text-sm hover:bg-slate-50 flex items-center gap-2 text-emerald-600"><svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"/></svg>Receive</button>';
        }
        html += '<button onclick="editPurchase(' + p.id + ');hideActions()" class="w-full px-3 py-1.5 text-left text-sm hover:bg-slate-50 flex items-center gap-2 text-slate-600"><svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>Edit</button>';
        html += '<button onclick="printPurchase(' + p.id + ');hideActions()" class="w-full px-3 py-1.5 text-left text-sm hover:bg-slate-50 flex items-center gap-2 text-slate-600"><svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"/></svg>Print</button>';
        html += '<div class="border-t border-slate-100 my-1"></div>';
        html += '<button onclick="deletePurchase(' + p.id + ');hideActions()" class="w-full px-3 py-1.5 text-left text-sm hover:bg-red-50 flex items-center gap-2 text-red-500"><svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>Delete</button>';
        html += '</div></div></td></tr>';
      }

      tbody.innerHTML = html;

      document.getElementById('showingFrom').textContent = filtered.length ? start + 1 : 0;
      document.getElementById('showingTo').textContent = Math.min(end, filtered.length);
      document.getElementById('totalItems').textContent = filtered.length;

      renderPagination(filtered.length, pageSize);
    }

    function renderPagination(total, pageSize) {
      var totalPages = Math.ceil(total / pageSize);
      var container = document.getElementById('pageNumbers');
      var html = '';

      for (var i = 1; i <= Math.min(totalPages, 5); i++) {
        html += '<button onclick="goToPage(' + i + ')" class="w-7 h-7 rounded-md ' + (i === currentPage ? 'bg-blue-500 text-white' : 'bg-slate-100 hover:bg-slate-200') + ' text-sm font-medium">' + i + '</button>';
      }

      container.innerHTML = html;
    }

    function goToPage(page) { currentPage = page; renderPurchases(); }
    function prevPage() { if (currentPage > 1) { currentPage--; renderPurchases(); } }
    function nextPage() { var filtered = getFilteredPurchases(); var pageSize = parseInt(document.getElementById('pageSize').value); if (currentPage < Math.ceil(filtered.length / pageSize)) { currentPage++; renderPurchases(); } }

    function resetFilters() {
      document.getElementById('searchInput').value = '';
      document.getElementById('dateFrom').value = '';
      document.getElementById('dateTo').value = '';
      document.getElementById('statusFilter').value = '';
      document.getElementById('paymentFilter').value = '';
      document.getElementById('supplierFilter').value = '';
      filterPurchases();
    }

    function viewPurchase(id) {
      var p = purchases.find(function(x) { return x.id === id; });
      if (!p) return;
      document.getElementById('modalPO').textContent = p.po;
      var due = p.total - p.paid;
      var html = '<div class="grid grid-cols-2 gap-4 mb-4">';
      html += '<div><p class="text-xs text-slate-400">Supplier</p><p class="font-medium">' + p.supplier + '</p></div>';
      html += '<div><p class="text-xs text-slate-400">Phone</p><p class="font-medium">' + p.phone + '</p></div>';
      html += '<div><p class="text-xs text-slate-400">Order Date</p><p class="font-medium">' + p.date + '</p></div>';
      html += '<div><p class="text-xs text-slate-400">Due Date</p><p class="font-medium">' + p.dueDate + '</p></div>';
      html += '<div><p class="text-xs text-slate-400">Supplier Invoice</p><p class="font-medium">' + (p.supplierInv || '-') + '</p></div>';
      html += '<div><p class="text-xs text-slate-400">Status</p><p><span class="tag ' + getStatusClass(p.status) + '">' + getStatusLabel(p.status) + '</span></p></div>';
      html += '</div>';
      html += '<div class="bg-slate-50 rounded-xl p-4">';
      html += '<div class="flex justify-between mb-2"><span class="text-slate-500">Items</span><span class="font-medium">' + p.items + '</span></div>';
      html += '<div class="flex justify-between mb-2"><span class="text-slate-500">Total</span><span class="font-semibold">$' + p.total.toFixed(2) + '</span></div>';
      html += '<div class="flex justify-between mb-2"><span class="text-slate-500">Paid</span><span class="font-medium text-emerald-600">$' + p.paid.toFixed(2) + '</span></div>';
      html += '<div class="flex justify-between pt-2 border-t border-slate-200"><span class="text-slate-500">Due</span><span class="font-bold ' + (due > 0 ? 'text-red-500' : 'text-slate-800') + '">$' + due.toFixed(2) + '</span></div>';
      html += '</div>';
      document.getElementById('modalContent').innerHTML = html;
      document.getElementById('viewModal').classList.remove('hidden');
      document.getElementById('viewModal').classList.add('flex');
    }

    function closeViewModal() {
      document.getElementById('viewModal').classList.add('hidden');
      document.getElementById('viewModal').classList.remove('flex');
    }

    function receivePurchase(id) {
      var p = purchases.find(function(x) { return x.id === id; });
      if (!p) return;
      receiveId = id;
      document.getElementById('receivePO').textContent = p.po;
      document.getElementById('receiveSupplier').textContent = p.supplier;
      document.getElementById('receiveDate').value = new Date().toISOString().split('T')[0];
      document.getElementById('receiveNotes').value = '';
      document.getElementById('receiveModal').classList.remove('hidden');
      document.getElementById('receiveModal').classList.add('flex');
    }

    function closeReceiveModal() {
      document.getElementById('receiveModal').classList.add('hidden');
      document.getElementById('receiveModal').classList.remove('flex');
      receiveId = null;
    }

    function confirmReceive() {
      if (receiveId) {
        var p = purchases.find(function(x) { return x.id === receiveId; });
        if (p) {
          p.status = 'received';
          renderPurchases();
        }
      }
      closeReceiveModal();
      alert('Stock received successfully!');
    }

    function editPurchase(id) { alert('Edit purchase: ' + id); }
    function printPurchase(id) { alert('Print purchase: ' + id); }
    function printPO() { alert('Printing...'); }

    function deletePurchase(id) {
      deleteId = id;
      document.getElementById('deleteModal').classList.remove('hidden');
      document.getElementById('deleteModal').classList.add('flex');
    }

    function closeDeleteModal() {
      document.getElementById('deleteModal').classList.add('hidden');
      document.getElementById('deleteModal').classList.remove('flex');
      deleteId = null;
    }

    function confirmDelete() {
      if (deleteId) {
        purchases = purchases.filter(function(p) { return p.id !== deleteId; });
        renderPurchases();
      }
      closeDeleteModal();
    }

    function exportPurchases() { alert('Exporting purchases...'); }

    renderPurchases();
  </script>
</body>
</html>