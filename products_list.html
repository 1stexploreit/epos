<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Products List - FreshMart POS</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
    *{font-family:'Inter',sans-serif;box-sizing:border-box;}
    body{background:#f8fafc;min-height:100vh;}
    .card{background:#fff;border:1px solid #e2e8f0;border-radius:10px;box-shadow:0 1px 3px rgba(0,0,0,0.05);}
    .input-light{background:#f8fafc;border:1px solid #e2e8f0;color:#1e293b;border-radius:6px;}
    .input-light:focus{outline:none;border-color:#10b981;box-shadow:0 0 0 3px rgba(16,185,129,0.1);}
    .btn-primary{background:linear-gradient(135deg,#10b981 0%,#059669 100%);color:#fff;font-weight:600;}
    .btn-primary:hover{background:linear-gradient(135deg,#34d399 0%,#10b981 100%);}
    .tag{font-size:9px;padding:3px 6px;border-radius:4px;font-weight:600;text-transform:uppercase;}
    ::-webkit-scrollbar{width:6px;height:6px;}
    ::-webkit-scrollbar-track{background:#f1f5f9;}
    ::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:3px;}
    .row-hover:hover{background:#f0fdf4;}
    .row-even{background:#f8fafc;}
    .row-odd{background:#ffffff;}
    .status-active{background:#d1fae5;color:#059669;}
    .status-inactive{background:#f1f5f9;color:#64748b;}
    .status-draft{background:#fef3c7;color:#d97706;}
    .stock-ok{background:#d1fae5;color:#059669;}
    .stock-low{background:#fef3c7;color:#d97706;}
    .stock-out{background:#fee2e2;color:#dc2626;}
  </style>
</head>
<body class="text-slate-700">
  
  <!-- Header -->
  <header class="bg-white border-b border-slate-200 sticky top-0 z-50">
    <div class="max-w-[1400px] mx-auto px-4 py-3">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-4">
          <button onclick="window.history.back()" class="w-9 h-9 rounded-lg bg-slate-100 hover:bg-slate-200 flex items-center justify-center transition">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
          </button>
          <div>
            <div class="flex items-center gap-2">
              <span class="tag bg-emerald-100 text-emerald-700">Inventory</span>
              <span class="text-xl font-bold text-slate-800">Products List</span>
            </div>
            <p class="text-xs text-slate-400 mt-0.5">Manage your product inventory</p>
          </div>
        </div>
        <div class="flex items-center gap-2">
          <button onclick="exportProducts()" class="px-3 py-2 rounded-lg bg-slate-100 hover:bg-slate-200 text-sm font-medium transition flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/></svg>
            Export
          </button>
          <a href="#" class="btn-primary px-4 py-2 rounded-lg text-sm flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
            Add Product
          </a>
        </div>
      </div>
    </div>
  </header>

  <main class="max-w-[1400px] mx-auto p-4 md:p-6">
    
    <!-- Summary Cards -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
      <div class="card p-4">
        <div class="flex items-center gap-3">
          <div class="w-9 h-9 rounded-lg bg-emerald-100 flex items-center justify-center">
            <svg class="w-5 h-5 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/></svg>
          </div>
          <div>
            <p class="text-xs text-slate-400">Total Products</p>
            <p class="text-xl font-bold text-slate-800" id="totalProducts">0</p>
          </div>
        </div>
      </div>
      <div class="card p-4">
        <div class="flex items-center gap-3">
          <div class="w-9 h-9 rounded-lg bg-blue-100 flex items-center justify-center">
            <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
          </div>
          <div>
            <p class="text-xs text-slate-400">In Stock</p>
            <p class="text-xl font-bold text-blue-600" id="inStock">0</p>
          </div>
        </div>
      </div>
      <div class="card p-4">
        <div class="flex items-center gap-3">
          <div class="w-9 h-9 rounded-lg bg-amber-100 flex items-center justify-center">
            <svg class="w-5 h-5 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
          </div>
          <div>
            <p class="text-xs text-slate-400">Low Stock</p>
            <p class="text-xl font-bold text-amber-600" id="lowStock">0</p>
          </div>
        </div>
      </div>
      <div class="card p-4">
        <div class="flex items-center gap-3">
          <div class="w-9 h-9 rounded-lg bg-red-100 flex items-center justify-center">
            <svg class="w-5 h-5 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"/></svg>
          </div>
          <div>
            <p class="text-xs text-slate-400">Out of Stock</p>
            <p class="text-xl font-bold text-red-600" id="outOfStock">0</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Filters -->
    <div class="card p-4 mb-4 bg-gradient-to-r from-emerald-50 to-teal-50 border-emerald-100">
      <div class="flex flex-wrap gap-3 items-center">
        <div class="flex items-center gap-2 bg-white border border-emerald-200 rounded-lg px-2 py-1.5 shadow-sm">
          <svg class="w-4 h-4 text-emerald-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
          <input type="text" id="searchInput" placeholder="Search SKU, name, brand..." class="bg-transparent border-0 text-sm w-48 focus:outline-none" oninput="filterProducts()">
        </div>
        <select id="categoryFilter" onchange="filterProducts()" class="bg-white border border-emerald-200 rounded-lg px-2 py-1.5 text-sm shadow-sm focus:outline-none">
          <option value="">All Categories</option>
          <option value="fruits">üçé Fruits</option>
          <option value="vegetables">ü•¨ Vegetables</option>
          <option value="dairy">ü•õ Dairy</option>
          <option value="bakery">üçû Bakery</option>
          <option value="beverages">ü•§ Beverages</option>
          <option value="snacks">üçø Snacks</option>
          <option value="household">üßπ Household</option>
        </select>
        <select id="statusFilter" onchange="filterProducts()" class="bg-white border border-emerald-200 rounded-lg px-2 py-1.5 text-sm shadow-sm focus:outline-none">
          <option value="">All Status</option>
          <option value="active">‚úÖ Active</option>
          <option value="inactive">‚è∏Ô∏è Inactive</option>
          <option value="draft">üìù Draft</option>
        </select>
        <select id="stockFilter" onchange="filterProducts()" class="bg-white border border-emerald-200 rounded-lg px-2 py-1.5 text-sm shadow-sm focus:outline-none">
          <option value="">All Stock</option>
          <option value="instock">In Stock</option>
          <option value="low">Low Stock</option>
          <option value="out">Out of Stock</option>
        </select>
        <select id="unitFilter" onchange="filterProducts()" class="bg-white border border-emerald-200 rounded-lg px-2 py-1.5 text-sm shadow-sm focus:outline-none">
          <option value="">All Units</option>
          <option value="piece">Piece</option>
          <option value="packet">Packet</option>
          <option value="bottle">Bottle</option>
          <option value="kg">Kg</option>
          <option value="liter">Liter</option>
        </select>
        <button onclick="resetFilters()" class="px-3 py-1.5 text-sm text-emerald-600 hover:text-emerald-700 font-medium">Reset</button>
      </div>
    </div>

    <!-- Products Table -->
    <div class="card overflow-hidden">
      <div class="overflow-x-auto">
        <table class="w-full" style="font-size: 0.80em;">
          <thead>
            <tr class="bg-slate-50">
              <th class="text-left p-3 text-xs font-semibold text-slate-500 uppercase tracking-wider w-12"></th>
              <th class="text-left p-3 text-xs font-semibold text-slate-500 uppercase tracking-wider">SKU</th>
              <th class="text-left p-3 text-xs font-semibold text-slate-500 uppercase tracking-wider">Product</th>
              <th class="text-left p-3 text-xs font-semibold text-slate-500 uppercase tracking-wider">Category</th>
              <th class="text-center p-3 text-xs font-semibold text-slate-500 uppercase tracking-wider">Unit</th>
              <th class="text-right p-3 text-xs font-semibold text-slate-500 uppercase tracking-wider">Cost</th>
              <th class="text-right p-3 text-xs font-semibold text-slate-500 uppercase tracking-wider">Price</th>
              <th class="text-center p-3 text-xs font-semibold text-slate-500 uppercase tracking-wider">Stock</th>
              <th class="text-center p-3 text-xs font-semibold text-slate-500 uppercase tracking-wider">Status</th>
              <th class="text-center p-3 text-xs font-semibold text-slate-500 uppercase tracking-wider w-16">Action</th>
            </tr>
          </thead>
          <tbody id="productsBody"></tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div class="px-4 py-3 border-t border-slate-100 flex items-center justify-between">
        <div class="flex items-center gap-2 text-sm text-slate-500">
          <span>Show</span>
          <select id="pageSize" onchange="renderProducts()" class="bg-slate-100 border-0 rounded-md px-2 py-1 text-sm">
            <option value="10">10</option>
            <option value="25">25</option>
            <option value="50">50</option>
          </select>
          <span class="text-slate-400">|</span>
          <span>Showing <span id="showingFrom">1</span>-<span id="showingTo">10</span> of <span id="totalItems">0</span></span>
        </div>
        <div class="flex items-center gap-1">
          <button onclick="prevPage()" class="px-2.5 py-1 rounded-md bg-slate-100 hover:bg-slate-200 text-sm disabled:opacity-50">Previous</button>
          <div id="pageNumbers" class="flex items-center gap-1"></div>
          <button onclick="nextPage()" class="px-2.5 py-1 rounded-md bg-slate-100 hover:bg-slate-200 text-sm disabled:opacity-50">Next</button>
        </div>
      </div>
    </div>
  </main>

  <!-- View Modal -->
  <div id="viewModal" class="fixed inset-0 bg-black/40 backdrop-blur-sm items-center justify-center z-50 p-4 hidden">
    <div class="card p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto">
      <div class="flex items-center justify-between mb-4">
        <div class="flex items-center gap-3">
          <div id="modalEmoji" class="w-12 h-12 bg-emerald-50 rounded-xl flex items-center justify-center text-2xl">üì¶</div>
          <div>
            <h3 class="text-lg font-bold text-slate-800" id="modalName">Product Name</h3>
            <p id="modalSku" class="text-emerald-600 font-mono text-sm">SKU-0001</p>
          </div>
        </div>
        <button onclick="closeViewModal()" class="w-8 h-8 rounded-lg bg-slate-100 hover:bg-slate-200 flex items-center justify-center">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <div id="modalContent"></div>
      <div class="flex gap-3 mt-5 pt-4 border-t border-slate-100">
        <button onclick="closeViewModal()" class="flex-1 py-2.5 rounded-xl bg-slate-100 hover:bg-slate-200 font-medium transition">Close</button>
        <button onclick="editFromModal()" class="flex-1 py-2.5 btn-primary rounded-xl flex items-center justify-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
          Edit
        </button>
      </div>
    </div>
  </div>

  <!-- Delete Modal -->
  <div id="deleteModal" class="fixed inset-0 bg-black/40 backdrop-blur-sm items-center justify-center z-50 p-4 hidden">
    <div class="card p-6 w-full max-w-sm text-center">
      <div class="w-14 h-14 rounded-full bg-red-100 flex items-center justify-center mx-auto mb-4">
        <svg class="w-7 h-7 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
      </div>
      <h3 class="text-lg font-bold text-slate-800 mb-2">Delete Product?</h3>
      <p class="text-sm text-slate-500 mb-5">This action cannot be undone. The product will be permanently removed.</p>
      <div class="flex gap-3">
        <button onclick="closeDeleteModal()" class="flex-1 py-2.5 rounded-xl bg-slate-100 hover:bg-slate-200 font-medium transition">Cancel</button>
        <button onclick="confirmDelete()" class="flex-1 py-2.5 rounded-xl bg-red-500 hover:bg-red-600 text-white font-medium transition">Delete</button>
      </div>
    </div>
  </div>

  <!-- Stock Adjust Modal -->
  <div id="stockModal" class="fixed inset-0 bg-black/40 backdrop-blur-sm items-center justify-center z-50 p-4 hidden">
    <div class="card p-6 w-full max-w-md">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-bold text-slate-800">Adjust Stock</h3>
        <button onclick="closeStockModal()" class="w-8 h-8 rounded-lg bg-slate-100 hover:bg-slate-200 flex items-center justify-center">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <div class="space-y-4">
        <div class="bg-emerald-50 rounded-xl p-4">
          <p class="text-sm text-emerald-600 font-medium" id="stockProductName">Product Name</p>
          <p class="text-xs text-emerald-500">Current Stock: <span id="currentStock" class="font-bold">0</span></p>
        </div>
        <div>
          <label class="text-xs text-slate-500 uppercase tracking-wider mb-1 block">Adjustment Type</label>
          <select id="adjustType" class="w-full input-light px-3 py-2.5 text-sm">
            <option value="add">‚ûï Add Stock</option>
            <option value="remove">‚ûñ Remove Stock</option>
            <option value="set">üîÑ Set Stock</option>
          </select>
        </div>
        <div>
          <label class="text-xs text-slate-500 uppercase tracking-wider mb-1 block">Quantity</label>
          <input type="number" id="adjustQty" class="w-full input-light px-3 py-2.5 text-sm" min="0">
        </div>
        <div>
          <label class="text-xs text-slate-500 uppercase tracking-wider mb-1 block">Reason</label>
          <textarea id="adjustReason" rows="2" class="w-full input-light px-3 py-2.5 text-sm resize-none" placeholder="Reason for adjustment..."></textarea>
        </div>
      </div>
      <div class="flex gap-3 mt-5">
        <button onclick="closeStockModal()" class="flex-1 py-2.5 rounded-xl bg-slate-100 hover:bg-slate-200 font-medium transition">Cancel</button>
        <button onclick="confirmStockAdjust()" class="flex-1 py-2.5 btn-primary rounded-xl">Update Stock</button>
      </div>
    </div>
  </div>

  <script>
    var products = [
      { id: 1, sku: 'SKU-FRT001', name: 'Fresh Apples', brand: 'FarmFresh', emoji: 'üçé', category: 'fruits', unit: 'kg', cost: 2.50, price: 3.99, wholesale: 3.20, stock: 150, lowStock: 20, status: 'active', featured: true },
      { id: 2, sku: 'SKU-FRT002', name: 'Organic Bananas', brand: 'GreenLife', emoji: 'üçå', category: 'fruits', unit: 'kg', cost: 1.20, price: 1.99, wholesale: 1.60, stock: 8, lowStock: 15, status: 'active', featured: false },
      { id: 3, sku: 'SKU-VEG001', name: 'Fresh Broccoli', brand: 'FarmFresh', emoji: 'ü•¶', category: 'vegetables', unit: 'piece', cost: 1.50, price: 2.49, wholesale: 2.00, stock: 45, lowStock: 10, status: 'active', featured: false },
      { id: 4, sku: 'SKU-DRY001', name: 'Whole Milk 1L', brand: 'DairyBest', emoji: 'ü•õ', category: 'dairy', unit: 'bottle', cost: 1.80, price: 2.99, wholesale: 2.50, stock: 0, lowStock: 25, status: 'active', featured: true },
      { id: 5, sku: 'SKU-BKY001', name: 'Whole Wheat Bread', brand: 'BakeHouse', emoji: 'üçû', category: 'bakery', unit: 'packet', cost: 1.20, price: 2.49, wholesale: 1.90, stock: 30, lowStock: 15, status: 'active', featured: false },
      { id: 6, sku: 'SKU-BEV001', name: 'Orange Juice 500ml', brand: 'FreshSqueeze', emoji: 'üßÉ', category: 'beverages', unit: 'bottle', cost: 2.00, price: 3.49, wholesale: 2.80, stock: 60, lowStock: 20, status: 'active', featured: false },
      { id: 7, sku: 'SKU-SNK001', name: 'Potato Chips Classic', brand: 'CrunchTime', emoji: 'üçø', category: 'snacks', unit: 'packet', cost: 1.00, price: 1.99, wholesale: 1.50, stock: 5, lowStock: 30, status: 'active', featured: false },
      { id: 8, sku: 'SKU-HLD001', name: 'All-Purpose Cleaner', brand: 'CleanPro', emoji: 'üßπ', category: 'household', unit: 'bottle', cost: 3.00, price: 4.99, wholesale: 4.00, stock: 25, lowStock: 10, status: 'active', featured: false },
      { id: 9, sku: 'SKU-FRT003', name: 'Fresh Oranges', brand: 'CitrusFarm', emoji: 'üçä', category: 'fruits', unit: 'kg', cost: 2.00, price: 3.49, wholesale: 2.80, stock: 80, lowStock: 20, status: 'active', featured: false },
      { id: 10, sku: 'SKU-VEG002', name: 'Organic Carrots', brand: 'GreenLife', emoji: 'ü•ï', category: 'vegetables', unit: 'kg', cost: 1.30, price: 2.29, wholesale: 1.80, stock: 0, lowStock: 15, status: 'inactive', featured: false },
      { id: 11, sku: 'SKU-DRY002', name: 'Cheddar Cheese 200g', brand: 'DairyBest', emoji: 'üßÄ', category: 'dairy', unit: 'packet', cost: 3.50, price: 5.49, wholesale: 4.50, stock: 18, lowStock: 10, status: 'active', featured: true },
      { id: 12, sku: 'SKU-BEV002', name: 'Sparkling Water 1L', brand: 'AquaPure', emoji: 'üíß', category: 'beverages', unit: 'bottle', cost: 0.80, price: 1.49, wholesale: 1.10, stock: 100, lowStock: 30, status: 'draft', featured: false }
    ];

    var currentPage = 1;
    var deleteId = null;
    var stockId = null;
    var viewId = null;
    var activeActionMenu = null;

    function toggleActions(id) {
      var menu = document.getElementById('actions-' + id);
      if (activeActionMenu && activeActionMenu !== menu) {
        activeActionMenu.classList.add('hidden');
      }
      menu.classList.toggle('hidden');
      activeActionMenu = menu.classList.contains('hidden') ? null : menu;
    }

    function hideActions() {
      if (activeActionMenu) {
        activeActionMenu.classList.add('hidden');
        activeActionMenu = null;
      }
    }

    document.addEventListener('click', function(e) {
      if (!e.target.closest('.relative')) {
        hideActions();
      }
    });

    function getCategoryLabel(cat) {
      var labels = { fruits: 'üçé Fruits', vegetables: 'ü•¨ Vegetables', dairy: 'ü•õ Dairy', bakery: 'üçû Bakery', beverages: 'ü•§ Beverages', snacks: 'üçø Snacks', household: 'üßπ Household' };
      return labels[cat] || cat;
    }

    function getStatusClass(status) {
      var classes = { active: 'status-active', inactive: 'status-inactive', draft: 'status-draft' };
      return classes[status] || 'status-active';
    }

    function getStatusLabel(status) {
      var labels = { active: '‚úÖ Active', inactive: '‚è∏Ô∏è Inactive', draft: 'üìù Draft' };
      return labels[status] || status;
    }

    function getStockStatus(p) {
      if (p.stock === 0) return { class: 'stock-out', label: 'Out' };
      if (p.stock <= p.lowStock) return { class: 'stock-low', label: 'Low' };
      return { class: 'stock-ok', label: 'OK' };
    }

    function updateSummary() {
      var total = products.length;
      var inStock = products.filter(function(p) { return p.stock > p.lowStock; }).length;
      var low = products.filter(function(p) { return p.stock > 0 && p.stock <= p.lowStock; }).length;
      var out = products.filter(function(p) { return p.stock === 0; }).length;
      document.getElementById('totalProducts').textContent = total;
      document.getElementById('inStock').textContent = inStock;
      document.getElementById('lowStock').textContent = low;
      document.getElementById('outOfStock').textContent = out;
    }

    function filterProducts() {
      currentPage = 1;
      renderProducts();
    }

    function getFilteredProducts() {
      var search = document.getElementById('searchInput').value.toLowerCase();
      var category = document.getElementById('categoryFilter').value;
      var status = document.getElementById('statusFilter').value;
      var stock = document.getElementById('stockFilter').value;
      var unit = document.getElementById('unitFilter').value;

      return products.filter(function(p) {
        if (search && p.sku.toLowerCase().indexOf(search) === -1 && p.name.toLowerCase().indexOf(search) === -1 && p.brand.toLowerCase().indexOf(search) === -1) return false;
        if (category && p.category !== category) return false;
        if (status && p.status !== status) return false;
        if (unit && p.unit !== unit) return false;
        if (stock === 'instock' && p.stock <= p.lowStock) return false;
        if (stock === 'low' && (p.stock === 0 || p.stock > p.lowStock)) return false;
        if (stock === 'out' && p.stock > 0) return false;
        return true;
      });
    }

    function renderProducts() {
      var filtered = getFilteredProducts();
      var pageSize = parseInt(document.getElementById('pageSize').value);
      var start = (currentPage - 1) * pageSize;
      var end = start + pageSize;
      var paged = filtered.slice(start, end);

      var tbody = document.getElementById('productsBody');
      var html = '';

      for (var i = 0; i < paged.length; i++) {
        var p = paged[i];
        var stockStatus = getStockStatus(p);
        
        html += '<tr class="border-b border-slate-100 row-hover ' + (i % 2 === 0 ? 'row-even' : 'row-odd') + '">';
        html += '<td class="p-3 text-center"><span class="text-xl">' + p.emoji + '</span></td>';
        html += '<td class="p-3"><span class="font-mono text-xs text-slate-500">' + p.sku + '</span></td>';
        html += '<td class="p-3"><p class="font-medium text-slate-800">' + p.name + '</p><p class="text-xs text-slate-400">' + p.brand + '</p></td>';
        html += '<td class="p-3"><span class="text-sm">' + getCategoryLabel(p.category) + '</span></td>';
        html += '<td class="p-3 text-center"><span class="tag bg-slate-100 text-slate-600 capitalize">' + p.unit + '</span></td>';
        html += '<td class="p-3 text-right text-slate-600">' + p.cost.toFixed(2) + '</td>';
        html += '<td class="p-3 text-right font-semibold text-slate-800">' + p.price.toFixed(2) + '</td>';
        html += '<td class="p-3 text-center"><div class="flex items-center justify-center gap-1"><span class="font-semibold">' + p.stock + '</span><span class="tag ' + stockStatus.class + '">' + stockStatus.label + '</span></div></td>';
        html += '<td class="p-3 text-center"><span class="tag ' + getStatusClass(p.status) + '">' + getStatusLabel(p.status) + '</span></td>';
        html += '<td class="p-3 text-center"><div class="relative inline-block">';
        html += '<button onclick="toggleActions(' + p.id + ')" class="px-2 py-1 rounded-md hover:bg-slate-200 flex items-center justify-center gap-1 text-slate-500 text-xs"><svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="1"/><circle cx="12" cy="5" r="1"/><circle cx="12" cy="19" r="1"/></svg>Action</button>';
        html += '<div id="actions-' + p.id + '" class="hidden absolute right-0 top-full mt-1 bg-white border border-slate-200 rounded-md shadow-lg z-20 py-1 min-w-[130px]">';
        html += '<button onclick="viewProduct(' + p.id + ');hideActions()" class="w-full px-3 py-1.5 text-left text-sm hover:bg-slate-50 flex items-center gap-2 text-slate-600"><svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>View</button>';
        html += '<button onclick="editProduct(' + p.id + ');hideActions()" class="w-full px-3 py-1.5 text-left text-sm hover:bg-slate-50 flex items-center gap-2 text-slate-600"><svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>Edit</button>';
        html += '<button onclick="adjustStock(' + p.id + ');hideActions()" class="w-full px-3 py-1.5 text-left text-sm hover:bg-slate-50 flex items-center gap-2 text-emerald-600"><svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A2 2 0 013 12V7a4 4 0 014-4z"/></svg>Adjust Stock</button>';
        html += '<button onclick="duplicateProduct(' + p.id + ');hideActions()" class="w-full px-3 py-1.5 text-left text-sm hover:bg-slate-50 flex items-center gap-2 text-slate-600"><svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>Duplicate</button>';
        html += '<div class="border-t border-slate-100 my-1"></div>';
        html += '<button onclick="deleteProduct(' + p.id + ');hideActions()" class="w-full px-3 py-1.5 text-left text-sm hover:bg-red-50 flex items-center gap-2 text-red-500"><svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>Delete</button>';
        html += '</div></div></td></tr>';
      }

      tbody.innerHTML = html;

      document.getElementById('showingFrom').textContent = filtered.length ? start + 1 : 0;
      document.getElementById('showingTo').textContent = Math.min(end, filtered.length);
      document.getElementById('totalItems').textContent = filtered.length;

      renderPagination(filtered.length, pageSize);
      updateSummary();
    }

    function renderPagination(total, pageSize) {
      var totalPages = Math.ceil(total / pageSize);
      var container = document.getElementById('pageNumbers');
      var html = '';

      for (var i = 1; i <= Math.min(totalPages, 5); i++) {
        html += '<button onclick="goToPage(' + i + ')" class="w-7 h-7 rounded-md ' + (i === currentPage ? 'bg-emerald-500 text-white' : 'bg-slate-100 hover:bg-slate-200') + ' text-sm font-medium">' + i + '</button>';
      }

      container.innerHTML = html;
    }

    function goToPage(page) { currentPage = page; renderProducts(); }
    function prevPage() { if (currentPage > 1) { currentPage--; renderProducts(); } }
    function nextPage() { var filtered = getFilteredProducts(); var pageSize = parseInt(document.getElementById('pageSize').value); if (currentPage < Math.ceil(filtered.length / pageSize)) { currentPage++; renderProducts(); } }

    function resetFilters() {
      document.getElementById('searchInput').value = '';
      document.getElementById('categoryFilter').value = '';
      document.getElementById('statusFilter').value = '';
      document.getElementById('stockFilter').value = '';
      document.getElementById('unitFilter').value = '';
      filterProducts();
    }

    function viewProduct(id) {
      var p = products.find(function(x) { return x.id === id; });
      if (!p) return;
      viewId = id;
      document.getElementById('modalEmoji').textContent = p.emoji;
      document.getElementById('modalName').textContent = p.name;
      document.getElementById('modalSku').textContent = p.sku;
      var stockStatus = getStockStatus(p);
      var html = '<div class="grid grid-cols-2 gap-4 mb-4">';
      html += '<div><p class="text-xs text-slate-400">Brand</p><p class="font-medium">' + p.brand + '</p></div>';
      html += '<div><p class="text-xs text-slate-400">Category</p><p class="font-medium">' + getCategoryLabel(p.category) + '</p></div>';
      html += '<div><p class="text-xs text-slate-400">Unit Type</p><p class="font-medium capitalize">' + p.unit + '</p></div>';
      html += '<div><p class="text-xs text-slate-400">Status</p><p><span class="tag ' + getStatusClass(p.status) + '">' + getStatusLabel(p.status) + '</span></p></div>';
      html += '</div>';
      html += '<div class="bg-slate-50 rounded-xl p-4 mb-4">';
      html += '<div class="grid grid-cols-3 gap-4 text-center">';
      html += '<div><p class="text-xs text-slate-400">Cost Price</p><p class="font-semibold text-slate-600">' + p.cost.toFixed(2) + '</p></div>';
      html += '<div><p class="text-xs text-slate-400">Selling Price</p><p class="font-bold text-emerald-600">' + p.price.toFixed(2) + '</p></div>';
      html += '<div><p class="text-xs text-slate-400">Wholesale</p><p class="font-semibold text-blue-600">' + p.wholesale.toFixed(2) + '</p></div>';
      html += '</div></div>';
      html += '<div class="bg-emerald-50 rounded-xl p-4">';
      html += '<div class="flex justify-between items-center">';
      html += '<div><p class="text-xs text-emerald-600">Current Stock</p><p class="text-2xl font-bold text-emerald-700">' + p.stock + ' <span class="text-sm font-normal">' + p.unit + '</span></p></div>';
      html += '<div class="text-right"><p class="text-xs text-slate-500">Low Stock Alert</p><p class="font-medium">' + p.lowStock + '</p></div>';
      html += '<span class="tag ' + stockStatus.class + ' text-sm px-3 py-1">' + stockStatus.label + '</span>';
      html += '</div></div>';
      if (p.featured) {
        html += '<div class="mt-3 flex items-center gap-2"><span class="tag bg-amber-100 text-amber-700">‚≠ê Featured Product</span></div>';
      }
      document.getElementById('modalContent').innerHTML = html;
      document.getElementById('viewModal').classList.remove('hidden');
      document.getElementById('viewModal').classList.add('flex');
    }

    function closeViewModal() {
      document.getElementById('viewModal').classList.add('hidden');
      document.getElementById('viewModal').classList.remove('flex');
      viewId = null;
    }

    function editFromModal() { if (viewId) editProduct(viewId); closeViewModal(); }
    function editProduct(id) { alert('Edit product: ' + id); }
    function duplicateProduct(id) { alert('Duplicate product: ' + id); }

    function adjustStock(id) {
      var p = products.find(function(x) { return x.id === id; });
      if (!p) return;
      stockId = id;
      document.getElementById('stockProductName').textContent = p.name;
      document.getElementById('currentStock').textContent = p.stock;
      document.getElementById('adjustType').value = 'add';
      document.getElementById('adjustQty').value = '';
      document.getElementById('adjustReason').value = '';
      document.getElementById('stockModal').classList.remove('hidden');
      document.getElementById('stockModal').classList.add('flex');
    }

    function closeStockModal() {
      document.getElementById('stockModal').classList.add('hidden');
      document.getElementById('stockModal').classList.remove('flex');
      stockId = null;
    }

    function confirmStockAdjust() {
      if (stockId) {
        var p = products.find(function(x) { return x.id === stockId; });
        if (p) {
          var type = document.getElementById('adjustType').value;
          var qty = parseInt(document.getElementById('adjustQty').value) || 0;
          if (type === 'add') p.stock += qty;
          else if (type === 'remove') p.stock = Math.max(0, p.stock - qty);
          else if (type === 'set') p.stock = Math.max(0, qty);
          renderProducts();
        }
      }
      closeStockModal();
    }

    function deleteProduct(id) {
      deleteId = id;
      document.getElementById('deleteModal').classList.remove('hidden');
      document.getElementById('deleteModal').classList.add('flex');
    }

    function closeDeleteModal() {
      document.getElementById('deleteModal').classList.add('hidden');
      document.getElementById('deleteModal').classList.remove('flex');
      deleteId = null;
    }

    function confirmDelete() {
      if (deleteId) {
        products = products.filter(function(p) { return p.id !== deleteId; });
        renderProducts();
      }
      closeDeleteModal();
    }

    function exportProducts() { alert('Exporting products...'); }

    renderProducts();
  </script>
</body>
</html>