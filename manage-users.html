<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Manage Users - FreshMart POS</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
*{font-family:'Inter',sans-serif}
input:focus,select:focus{outline:none;border-color:#10b981;box-shadow:0 0 0 3px rgba(16,185,129,0.1)}
.toggle-checkbox:checked{right:0;border-color:#10b981;background-color:#10b981}
.toggle-checkbox:checked+.toggle-label{background-color:#d1fae5}
</style>
</head>
<body class="bg-slate-100 min-h-screen">

<main class="max-w-7xl mx-auto px-6 py-5 space-y-4">

<!-- Search & Filter -->
<div class="bg-white rounded-xl shadow-sm border border-slate-200/80 p-3">
<div class="flex flex-col md:flex-row gap-2">
<div class="flex-1 relative">
<svg class="w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-slate-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
<input type="text" id="search" placeholder="Search by name, username, email..." class="w-full pl-9 pr-4 py-2 border border-slate-200 rounded-lg text-sm" oninput="renderTable()">
</div>
<div class="flex gap-2">
<select id="filterRole" class="px-3 py-2 border border-slate-200 rounded-lg text-sm text-slate-600" onchange="renderTable()">
<option value="">All Roles</option>
<option value="Super Admin">Super Admin</option>
<option value="Admin">Admin</option>
<option value="Manager">Manager</option>
<option value="Cashier">Cashier</option>
<option value="Accountant">Accountant</option>
</select>
<select id="filterBranch" class="px-3 py-2 border border-slate-200 rounded-lg text-sm text-slate-600" onchange="renderTable()">
<option value="">All Branches</option>
<option>Main Branch</option>
<option>Dhanmondi Branch</option>
<option>Uttara Branch</option>
</select>
<select id="filterWarehouse" class="px-3 py-2 border border-slate-200 rounded-lg text-sm text-slate-600" onchange="renderTable()">
<option value="">All Warehouse</option>
<option>Central Warehouse</option>
<option>Warehouse-2</option>
</select>
<select id="filterStatus" class="px-3 py-2 border border-slate-200 rounded-lg text-sm text-slate-600" onchange="renderTable()">
<option value="">All Status</option>
<option value="Active">Active</option>
<option value="Inactive">Inactive</option>
<option value="Suspended">Suspended</option>
</select>
<button onclick="openRolesModal()" class="px-3 py-2 text-sm text-slate-600 bg-slate-100 hover:bg-slate-200 rounded-lg font-medium flex items-center gap-2">
<svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>Roles
</button>
<button onclick="openUserModal()" class="px-4 py-2 text-sm bg-gradient-to-r from-emerald-500 to-emerald-600 text-white rounded-lg font-medium shadow-sm hover:shadow flex items-center gap-2">
<svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/></svg>Add User
</button>
</div>
</div>
</div>

<!-- User Table -->
<div class="bg-white rounded-xl shadow-sm border border-slate-200/80 overflow-hidden">
<table class="w-full">
<thead class="bg-slate-50 border-b border-slate-200">
<tr class="text-[10px] text-slate-500 uppercase tracking-wider">
<th class="px-4 py-3 text-left font-semibold">User</th>
<th class="px-4 py-3 text-left font-semibold">Role</th>
<th class="px-4 py-3 text-left font-semibold">Branch</th>
<th class="px-4 py-3 text-left font-semibold">Warehouse</th>
<th class="px-4 py-3 text-left font-semibold">Last Login</th>
<th class="px-4 py-3 text-center font-semibold">Status</th>
<th class="px-4 py-3 text-right font-semibold">Actions</th>
</tr>
</thead>
<tbody id="tableBody" class="divide-y divide-slate-100"></tbody>
</table>
<div id="emptyState" class="p-12 text-center" style="display:none">
<div class="w-16 h-16 mx-auto bg-slate-100 rounded-full flex items-center justify-center mb-4">
<svg class="w-8 h-8 text-slate-400" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z"/></svg>
</div>
<p class="text-slate-600 font-medium">No users found</p>
<p class="text-sm text-slate-400 mt-1">Try adjusting your search or filters</p>
</div>
</div>

</main>

<!-- Add/Edit User Modal -->
<div id="userModal" class="fixed inset-0 z-50 flex items-center justify-center p-4" style="display:none">
<div class="absolute inset-0 bg-slate-900/50 backdrop-blur-sm" onclick="closeUserModal()"></div>
<div class="relative bg-white rounded-xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto">
<div class="sticky top-0 bg-white px-6 py-4 border-b border-slate-200 flex items-center justify-between">
<h3 class="text-lg font-semibold text-slate-800" id="modalTitle">Add New User</h3>
<button onclick="closeUserModal()" class="p-1 text-slate-400 hover:text-slate-600 rounded-lg hover:bg-slate-100">
<svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
</button>
</div>
<div class="p-6 space-y-4">
<input type="hidden" id="editUserId">
<div class="grid grid-cols-2 gap-4">
<div class="col-span-2">
<label class="text-xs text-slate-500 font-semibold uppercase tracking-wider">Photo</label>
<input type="file" id="avatarInput" accept="image/*" class="w-full mt-1.5 px-3 py-2 border border-slate-200 rounded-lg text-sm file:mr-3 file:py-1 file:px-3 file:rounded-md file:border-0 file:text-xs file:font-medium file:bg-emerald-50 file:text-emerald-600 hover:file:bg-emerald-100">
</div>
<div class="col-span-2">
<label class="text-xs text-slate-500 font-semibold uppercase tracking-wider">Full Name <span class="text-red-400">*</span></label>
<input type="text" id="inpFullName" class="w-full mt-1.5 px-4 py-2.5 border border-slate-200 rounded-lg text-sm" placeholder="Enter full name">
</div>
<div>
<label class="text-xs text-slate-500 font-semibold uppercase tracking-wider">Username <span class="text-red-400">*</span></label>
<input type="text" id="inpUsername" class="w-full mt-1.5 px-4 py-2.5 border border-slate-200 rounded-lg text-sm" placeholder="username">
</div>
<div>
<label class="text-xs text-slate-500 font-semibold uppercase tracking-wider">Staff ID</label>
<input type="text" id="inpStaffId" class="w-full mt-1.5 px-4 py-2.5 border border-slate-200 rounded-lg text-sm" placeholder="e.g., EMP-001">
</div>
<div>
<label class="text-xs text-slate-500 font-semibold uppercase tracking-wider">Email</label>
<input type="email" id="inpEmail" class="w-full mt-1.5 px-4 py-2.5 border border-slate-200 rounded-lg text-sm" placeholder="email@example.com">
</div>
<div>
<label class="text-xs text-slate-500 font-semibold uppercase tracking-wider">Mobile</label>
<input type="tel" id="inpPhone" class="w-full mt-1.5 px-4 py-2.5 border border-slate-200 rounded-lg text-sm" placeholder="+880 1XXX XXXXXX">
</div>
<div>
<label class="text-xs text-slate-500 font-semibold uppercase tracking-wider">Role <span class="text-red-400">*</span></label>
<select id="inpRole" class="w-full mt-1.5 px-4 py-2.5 border border-slate-200 rounded-lg text-sm">
<option value="">Select Role</option>
<option>Super Admin</option>
<option>Admin</option>
<option>Manager</option>
<option>Cashier</option>
<option>Accountant</option>
</select>
</div>
<div>
<label class="text-xs text-slate-500 font-semibold uppercase tracking-wider">Branch (Sales) <span class="text-red-400">*</span></label>
<select id="inpBranch" class="w-full mt-1.5 px-4 py-2.5 border border-slate-200 rounded-lg text-sm">
<option value="">Select Branch</option>
<option>All Branches</option>
<option>Main Branch</option>
<option>Dhanmondi Branch</option>
<option>Uttara Branch</option>
</select>
</div>
<div>
<label class="text-xs text-slate-500 font-semibold uppercase tracking-wider">Warehouse Access</label>
<select id="inpWarehouse" class="w-full mt-1.5 px-4 py-2.5 border border-slate-200 rounded-lg text-sm">
<option value="">No Access</option>
<option>All Warehouses</option>
<option>Central Warehouse</option>
<option>Warehouse-2</option>
</select>
</div>
<div>
<label class="text-xs text-slate-500 font-semibold uppercase tracking-wider">Status</label>
<select id="inpStatus" class="w-full mt-1.5 px-4 py-2.5 border border-slate-200 rounded-lg text-sm">
<option value="Active">Active</option>
<option value="Inactive">Inactive</option>
<option value="Suspended">Suspended</option>
</select>
</div>
<div class="col-span-2" id="passwordSection">
<label class="text-xs text-slate-500 font-semibold uppercase tracking-wider">Password <span class="text-red-400">*</span></label>
<div class="relative mt-1.5">
<input type="password" id="inpPassword" class="w-full px-4 py-2.5 pr-20 border border-slate-200 rounded-lg text-sm" placeholder="Enter password">
<button type="button" onclick="generatePassword()" class="absolute right-2 top-1/2 -translate-y-1/2 px-2 py-1 text-[10px] font-medium text-emerald-600 bg-emerald-50 hover:bg-emerald-100 rounded">Generate</button>
</div>
</div>
</div>
</div>
<div class="sticky bottom-0 bg-slate-50 px-6 py-4 border-t border-slate-200 flex justify-end gap-3">
<button onclick="closeUserModal()" class="px-4 py-2.5 text-sm text-slate-600 bg-white border border-slate-200 hover:bg-slate-50 rounded-lg font-medium">Cancel</button>
<button onclick="saveUser()" class="px-5 py-2.5 text-sm bg-gradient-to-r from-emerald-500 to-emerald-600 text-white rounded-lg font-medium shadow-sm hover:shadow flex items-center gap-2">
<svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>Save User
</button>
</div>
</div>
</div>

<!-- Delete/Suspend Modal -->
<div id="actionModal" class="fixed inset-0 z-50 flex items-center justify-center p-4" style="display:none">
<div class="absolute inset-0 bg-slate-900/40 backdrop-blur-sm" onclick="closeActionModal()"></div>
<div class="relative bg-white rounded-xl shadow-2xl w-full max-w-sm p-6">
<div class="text-center">
<div class="w-14 h-14 mx-auto rounded-full flex items-center justify-center mb-4" id="actionIcon"></div>
<h3 class="text-lg font-semibold text-slate-800 mb-2" id="actionTitle">Confirm Action</h3>
<p class="text-sm text-slate-500 mb-6" id="actionMessage">Are you sure?</p>
<div class="flex gap-3">
<button onclick="closeActionModal()" class="flex-1 px-4 py-2.5 text-sm text-slate-600 bg-slate-100 hover:bg-slate-200 rounded-lg font-medium">Cancel</button>
<button onclick="confirmAction()" class="flex-1 px-4 py-2.5 text-sm text-white rounded-lg font-medium" id="actionBtn">Confirm</button>
</div>
</div>
</div>
</div>

<!-- Toast -->
<div id="toast" class="fixed top-4 right-4 z-50 px-4 py-3 bg-slate-800 text-white text-sm rounded-lg shadow-lg flex items-center gap-2" style="display:none">
<svg id="toastIcon" class="w-5 h-5 text-emerald-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
<span id="toastMsg">Saved</span>
</div>

<script>
let users=[
{id:1,name:"Rahim Ahmed",username:"rahim_admin",staffId:"EMP-001",email:"rahim@freshmart.com",phone:"+880 1711 111111",role:"Super Admin",branch:"All Branches",warehouse:"All Warehouses",status:"Active",lastLogin:"2 mins ago",online:true},
{id:2,name:"Karim Hossain",username:"karim_mgr",staffId:"EMP-002",email:"karim@freshmart.com",phone:"+880 1722 222222",role:"Manager",branch:"Main Branch",warehouse:"Central Warehouse",status:"Active",lastLogin:"1 hour ago",online:true},
{id:3,name:"Fatima Begum",username:"fatima_cash",staffId:"EMP-003",email:"fatima@freshmart.com",phone:"+880 1733 333333",role:"Cashier",branch:"Dhanmondi Branch",warehouse:"",status:"Active",lastLogin:"3 hours ago",online:false},
{id:4,name:"Jamal Uddin",username:"jamal_cash",staffId:"EMP-004",email:"jamal@freshmart.com",phone:"+880 1744 444444",role:"Cashier",branch:"Uttara Branch",warehouse:"",status:"Inactive",lastLogin:"2 days ago",online:false},
{id:5,name:"Nasreen Akter",username:"nasreen_acc",staffId:"EMP-005",email:"nasreen@freshmart.com",phone:"+880 1755 555555",role:"Accountant",branch:"Main Branch",warehouse:"Central Warehouse",status:"Active",lastLogin:"30 mins ago",online:true},
{id:6,name:"Abdul Karim",username:"abdul_wh",staffId:"EMP-006",email:"abdul@freshmart.com",phone:"+880 1766 666666",role:"Manager",branch:"",warehouse:"Central Warehouse",status:"Suspended",lastLogin:"1 week ago",online:false},
{id:7,name:"Salma Khatun",username:"salma_admin",staffId:"EMP-007",email:"salma@freshmart.com",phone:"+880 1777 777777",role:"Admin",branch:"Dhanmondi Branch",warehouse:"Warehouse-2",status:"Active",lastLogin:"5 mins ago",online:true},
];

let actionType='';
let actionUserId=null;

function showToast(msg,success=true){
const t=document.getElementById('toast');
document.getElementById('toastMsg').textContent=msg;
document.getElementById('toastIcon').className=`w-5 h-5 ${success?'text-emerald-400':'text-red-400'}`;
t.style.display='flex';
setTimeout(()=>t.style.display='none',3000);
}

function getFiltered(){
const search=document.getElementById('search').value.toLowerCase();
const role=document.getElementById('filterRole').value;
const branch=document.getElementById('filterBranch').value;
const warehouse=document.getElementById('filterWarehouse').value;
const status=document.getElementById('filterStatus').value;
return users.filter(u=>{
const match=u.name.toLowerCase().includes(search)||u.username.toLowerCase().includes(search)||u.email.toLowerCase().includes(search);
const branchMatch=!branch||u.branch===branch||u.branch==='All Branches';
const warehouseMatch=!warehouse||u.warehouse===warehouse||u.warehouse==='All Warehouses';
return match&&(!role||u.role===role)&&branchMatch&&warehouseMatch&&(!status||u.status===status);
});
}

function getRoleBadge(role){
const colors={'Super Admin':'bg-purple-100 text-purple-700 ring-purple-600/20','Admin':'bg-indigo-100 text-indigo-700 ring-indigo-600/20','Manager':'bg-blue-100 text-blue-700 ring-blue-600/20','Cashier':'bg-emerald-100 text-emerald-700 ring-emerald-600/20','Accountant':'bg-amber-100 text-amber-700 ring-amber-600/20'};
return colors[role]||'bg-slate-100 text-slate-700 ring-slate-600/20';
}

function getStatusBadge(status){
const colors={'Active':'bg-emerald-50 text-emerald-700 ring-emerald-600/20','Inactive':'bg-slate-100 text-slate-500 ring-slate-500/10','Suspended':'bg-red-50 text-red-600 ring-red-600/20'};
return colors[status]||'bg-slate-100 text-slate-600';
}

function renderTable(){
const filtered=getFiltered();
if(!filtered.length){
document.getElementById('tableBody').innerHTML='';
document.getElementById('emptyState').style.display='block';
return;
}
document.getElementById('emptyState').style.display='none';
document.getElementById('tableBody').innerHTML=filtered.map(u=>`
<tr class="hover:bg-slate-50/80 text-[13px]">
<td class="px-4 py-3">
<div class="flex items-center gap-3">
<div class="relative">
<div class="w-10 h-10 rounded-full bg-gradient-to-br from-emerald-400 to-emerald-600 flex items-center justify-center text-white font-semibold text-sm">${u.name.split(' ').map(n=>n[0]).join('').slice(0,2)}</div>
${u.online?'<span class="absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-emerald-500 border-2 border-white rounded-full"></span>':''}
</div>
<div>
<p class="font-semibold text-slate-800">${u.name}</p>
<p class="text-[11px] text-slate-400">@${u.username} • ${u.staffId||'—'}</p>
</div>
</div>
</td>
<td class="px-4 py-3"><span class="inline-flex px-2 py-0.5 text-[10px] font-semibold rounded-full ring-1 ${getRoleBadge(u.role)}">${u.role}</span></td>
<td class="px-4 py-3 text-slate-600">${u.branch||'—'}</td>
<td class="px-4 py-3 text-slate-600">${u.warehouse||'—'}</td>
<td class="px-4 py-3 text-slate-500 text-xs">${u.lastLogin}</td>
<td class="px-4 py-3 text-center"><span class="inline-flex px-2 py-0.5 text-[10px] font-semibold rounded-full ring-1 ${getStatusBadge(u.status)}">${u.status}</span></td>
<td class="px-4 py-3">
<div class="flex justify-end gap-1">
<button onclick="editUser(${u.id})" class="p-1.5 text-slate-400 hover:text-emerald-600 hover:bg-emerald-50 rounded-lg" title="Edit"><svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg></button>
<button onclick="resetPassword(${u.id})" class="p-1.5 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg" title="Reset Password"><svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"/></svg></button>
${u.status==='Suspended'?`<button onclick="openActionModal('activate',${u.id})" class="p-1.5 text-slate-400 hover:text-emerald-600 hover:bg-emerald-50 rounded-lg" title="Activate"><svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg></button>`:`<button onclick="openActionModal('suspend',${u.id})" class="p-1.5 text-slate-400 hover:text-amber-600 hover:bg-amber-50 rounded-lg" title="Suspend"><svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"/></svg></button>`}
<button onclick="openActionModal('delete',${u.id})" class="p-1.5 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-lg" title="Delete"><svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg></button>
</div>
</td>
</tr>`).join('');
}

function openUserModal(userId=null){
document.getElementById('modalTitle').textContent=userId?'Edit User':'Add New User';
document.getElementById('editUserId').value=userId||'';
document.getElementById('passwordSection').style.display=userId?'none':'block';
if(userId){
const u=users.find(x=>x.id===userId);
if(u){
document.getElementById('inpFullName').value=u.name;
document.getElementById('inpUsername').value=u.username;
document.getElementById('inpStaffId').value=u.staffId||'';
document.getElementById('inpEmail').value=u.email;
document.getElementById('inpPhone').value=u.phone;
document.getElementById('inpRole').value=u.role;
document.getElementById('inpBranch').value=u.branch;
document.getElementById('inpWarehouse').value=u.warehouse||'';
document.getElementById('inpStatus').value=u.status;
}
}else{
['inpFullName','inpUsername','inpStaffId','inpEmail','inpPhone','inpPassword'].forEach(id=>document.getElementById(id).value='');
document.getElementById('inpRole').value='';
document.getElementById('inpBranch').value='';
document.getElementById('inpWarehouse').value='';
document.getElementById('inpStatus').value='Active';
document.getElementById('avatarInput').value='';
}
document.getElementById('userModal').style.display='flex';
}

function closeUserModal(){document.getElementById('userModal').style.display='none';}

function editUser(id){openUserModal(id);}

function generatePassword(){
const chars='ABCDEFGHJKLMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz23456789!@#$%';
let pass='';for(let i=0;i<12;i++)pass+=chars.charAt(Math.floor(Math.random()*chars.length));
document.getElementById('inpPassword').value=pass;
document.getElementById('inpPassword').type='text';
setTimeout(()=>document.getElementById('inpPassword').type='password',3000);
}

function saveUser(){
const name=document.getElementById('inpFullName').value.trim();
const username=document.getElementById('inpUsername').value.trim();
const role=document.getElementById('inpRole').value;
const branch=document.getElementById('inpBranch').value;
const warehouse=document.getElementById('inpWarehouse').value;
if(!name||!username||!role||!branch){showToast('Please fill required fields',false);return;}
const editId=document.getElementById('editUserId').value;
if(editId){
const idx=users.findIndex(u=>u.id==editId);
if(idx>-1){
users[idx].name=name;
users[idx].username=username;
users[idx].staffId=document.getElementById('inpStaffId').value.trim();
users[idx].email=document.getElementById('inpEmail').value.trim();
users[idx].phone=document.getElementById('inpPhone').value.trim();
users[idx].role=role;
users[idx].branch=branch;
users[idx].warehouse=warehouse;
users[idx].status=document.getElementById('inpStatus').value;
}
showToast('User updated successfully!');
}else{
users.push({id:Date.now(),name,username,staffId:document.getElementById('inpStaffId').value.trim(),email:document.getElementById('inpEmail').value.trim(),phone:document.getElementById('inpPhone').value.trim(),role,branch,warehouse,status:document.getElementById('inpStatus').value,lastLogin:'Never',online:false});
showToast('User created successfully!');
}
closeUserModal();
renderTable();
}

function resetPassword(id){
const u=users.find(x=>x.id===id);
if(u)showToast(`Password reset link sent to ${u.email}`);
}

function openActionModal(type,id){
actionType=type;actionUserId=id;
const u=users.find(x=>x.id===id);
const modal=document.getElementById('actionModal');
const icon=document.getElementById('actionIcon');
const btn=document.getElementById('actionBtn');
if(type==='delete'){
icon.className='w-14 h-14 mx-auto bg-red-100 rounded-full flex items-center justify-center mb-4';
icon.innerHTML='<svg class="w-7 h-7 text-red-600" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>';
document.getElementById('actionTitle').textContent='Delete User?';
document.getElementById('actionMessage').textContent=`Are you sure you want to delete "${u?.name}"? This cannot be undone.`;
btn.className='flex-1 px-4 py-2.5 text-sm text-white rounded-lg font-medium bg-red-500 hover:bg-red-600';
btn.textContent='Delete';
}else if(type==='suspend'){
icon.className='w-14 h-14 mx-auto bg-amber-100 rounded-full flex items-center justify-center mb-4';
icon.innerHTML='<svg class="w-7 h-7 text-amber-600" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"/></svg>';
document.getElementById('actionTitle').textContent='Suspend User?';
document.getElementById('actionMessage').textContent=`Suspend "${u?.name}"? They won't be able to log in.`;
btn.className='flex-1 px-4 py-2.5 text-sm text-white rounded-lg font-medium bg-amber-500 hover:bg-amber-600';
btn.textContent='Suspend';
}else{
icon.className='w-14 h-14 mx-auto bg-emerald-100 rounded-full flex items-center justify-center mb-4';
icon.innerHTML='<svg class="w-7 h-7 text-emerald-600" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>';
document.getElementById('actionTitle').textContent='Activate User?';
document.getElementById('actionMessage').textContent=`Reactivate "${u?.name}"?`;
btn.className='flex-1 px-4 py-2.5 text-sm text-white rounded-lg font-medium bg-emerald-500 hover:bg-emerald-600';
btn.textContent='Activate';
}
modal.style.display='flex';
}

function closeActionModal(){document.getElementById('actionModal').style.display='none';}

function confirmAction(){
if(actionType==='delete'){
users=users.filter(u=>u.id!==actionUserId);
showToast('User deleted');
}else if(actionType==='suspend'){
const u=users.find(x=>x.id===actionUserId);
if(u){u.status='Suspended';u.online=false;}
showToast('User suspended');
}else{
const u=users.find(x=>x.id===actionUserId);
if(u)u.status='Active';
showToast('User activated');
}
closeActionModal();
renderTable();
}

function openRolesModal(){showToast('Opening role management...');}

renderTable();
</script>
</body>
</html>
